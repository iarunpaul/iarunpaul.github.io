<html lang="en"><head><meta charset="utf-8"><title>Kubernetes production best practices</title><meta name="description" content="This document highlights and consolidates best practices for building, deploying and scaling apps on Kubernetes in production."><meta name="author" content="Learnk8s"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@learnk8s"><meta property="fb:app_id" content="398212777530104"><link rel="icon" href="/favicon.ico"><link rel="icon" href="https://learnk8s.io/a/f7e5160d4744cf05c46161170b5c11c9.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="https://learnk8s.io/a/fddc0853df06c9c0c0f9f79b96abc14d.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="alternate" type="application/rss+xml" title="Subscribe to Learnk8s RSS" href="/rss.xml"><meta property="og:site_name" content="Learnk8s"><meta name="pocket-site-verification" content="1476398dfb5a771a94da9466e0bb43"><meta property="og:url" content="https://learnk8s.io/production-best-practices"><meta property="og:type" content="website"><meta property="og:title" content="Kubernetes production best practices"><meta property="og:image" content="https://learnk8s.io/a/b989b87a7521d241fdaf30703205e77b.jpg"><meta property="og:description" content="This document highlights and consolidates best practices for building, deploying and scaling apps on Kubernetes in production."><link rel="canonical" href="https://learnk8s.io/production-best-practices"><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script async="" src="https://www.googletagmanager.com/gtm.js?id=GTM-5WCKPRL"></script><script class="ignore-optimise">(function (w, d, s, l, i) {
w[l] = w[l] || []; w[l].push({
  'gtm.start':
    new Date().getTime(), event: 'gtm.js'
}); var f = d.getElementsByTagName(s)[0],
  j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5WCKPRL');</script><style>.hamburger-icon{position:relative;display:inline-block;width:1.625em;height:.213em;background:#fff;border-radius:.2rem}.hamburger-icon:after,.hamburger-icon:before{content:"";position:absolute;width:1.625em;height:.213em;background:#fff}.hamburger-icon:before{top:-.625em}.hamburger-icon:after{bottom:-.625em}.module .details.toggle-collapse{height:0;max-height:0;overflow:hidden}.controls .close{display:inline-block}.controls .open,.module .controls.toggle-collapse .close{display:none}.module .controls.toggle-collapse .open{display:inline-block}.tick-checkbox:checked{background:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMzAgMzAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzNCREJCOCIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGwtb3BhY2l0eT0iLjIiIGN4PSIxNSIgY3k9IjE1IiByPSIxNSIvPjxwYXRoIGQ9Ik0yMi42MSAxMi4xMTZjMCAuMjM1LS4wOTQuNDctLjI2My42NGwtOC4wOTkgOC4wOThhLjkxMy45MTMgMCAwMS0xLjI4IDBsLTQuNjktNC42OWEuOTEzLjkxMyAwIDAxMC0xLjI4bDEuMjgtMS4yOGEuOTEzLjkxMyAwIDAxMS4yODEgMGwyLjc3IDIuNzc3IDYuMTc3LTYuMTg2YS45MTMuOTEzIDAgMDExLjI4IDBsMS4yOCAxLjI4Yy4xNy4xNy4yNjUuNDA1LjI2NS42NHoiLz48L2c+PC9zdmc+");border:none}.tick-checkbox:checked~span{text-decoration:line-through;color:#d3d3d3}.arr-up{transform:rotate(-135deg) translate(-.2em,-.2em);-webkit-transform:rotate(-135deg) translate(-.2em,-.2em)}.arr-down,.arr-up{border:solid;border-width:0 .2em .2em 0;display:inline-block;padding:.4em}.arr-down{transform:rotate(45deg) translate(-.2em,-.2em);-webkit-transform:rotate(45deg) translate(-.2em,-.2em)}.new-hero{border-bottom-right-radius:80% 36%;border-bottom-left-radius:0 52%;background:linear-gradient(180deg,#569ad1 18%,#3889c7 72%)}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}strong{font-weight:bolder}code{font-family:monospace,monospace;font-size:1em}img{border-style:none}button,input{font-family:inherit;font-size:100%;line-height:1.15;margin:0;overflow:visible}button{text-transform:none;-webkit-appearance:button}button::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring{outline:1px dotted ButtonText}[type=checkbox]{padding:0}[type=checkbox],a,blockquote,body,code,div,footer,h1,h2,h3,header,html,li,nav,ol,p,pre,section,ul{box-sizing:border-box}.bg-light-gray{background-color:#eee}.b--light-gray{border-color:#eee}.bg-near-white{background-color:#f4f4f4}.white{color:#fff}.bg-white{background-color:#fff}.black-80{color:rgba(0,0,0,.8)}.black-60{color:rgba(0,0,0,.6)}.white-70{color:hsla(0,0%,100%,.7)}.bg-dark-red{background-color:#e7040f}.bg-yellow{background-color:gold}.bg-green{background-color:#19a974}.b--blue{border-color:#357edd}.b--light-blue{border-color:#96ccff}.hover-navy:focus,.hover-navy:hover,.navy{color:#001b44}.bg-navy{background-color:#001b44}.hover-sky:focus,.hover-sky:hover{color:#569ad1}.bg-sky{background-color:#569ad1}.bg-evian{background-color:#f7f9fc}.bg-transparent{background-color:transparent}.link{text-decoration:none}.link,.link:active,.link:focus,.link:hover,.link:link,.link:visited{transition:color .15s ease-in}.link:focus{outline:1px dotted currentColor}.ba{border-style:solid;border-width:1px}.bt{border-top-style:solid;border-top-width:1px}.br{border-right-style:solid;border-right-width:1px}.bb{border-bottom-style:solid;border-bottom-width:1px}.bl{border-left-style:solid;border-left-width:1px}.bn{border-style:none;border-width:0}.br2{border-radius:.25rem}.br-100{border-radius:100%}.br--bottom{border-top-left-radius:0;border-top-right-radius:0}.br--top{border-bottom-left-radius:0;border-bottom-right-radius:0}.bw1{border-width:.125rem}.bw2{border-width:.25rem}.top-0{top:0}.left-0{left:0}.right-1{right:1rem}.cf:after,.cf:before{content:" ";display:table}.cf:after{clear:both}.cf{*zoom:1}.dn{display:none}.db{display:block}.dib{display:inline-block}.flex{display:flex}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.flex-shrink-0{flex-shrink:0}.i{font-style:italic}.fs-normal{font-style:normal}.b{font-weight:700}.h1{height:1rem}.h2{height:2rem}.min-h-100{min-height:100%}.center{margin-right:auto;margin-left:auto}.lh-solid{line-height:1}.lh-copy{line-height:1.5}.mw2{max-width:2rem}.mw6{max-width:32rem}.mw8{max-width:64rem}.w1{width:1rem}.w2{width:2rem}.w4{width:8rem}.w-40{width:40%}.w-100{width:100%}.overflow-auto{overflow:auto}.relative{position:relative}.absolute{position:absolute}.sticky{position:sticky}.pl0{padding-left:0}.pt0{padding-top:0}.mt0,.mv0{margin-top:0}.mv0{margin-bottom:0}.pl1{padding-left:.25rem}.pb1,.pv1{padding-bottom:.25rem}.pv1{padding-top:.25rem}.ml1{margin-left:.25rem}.mv1{margin-top:.25rem;margin-bottom:.25rem}.pt2,.pv2{padding-top:.5rem}.pv2{padding-bottom:.5rem}.ph2{padding-left:.5rem;padding-right:.5rem}.mb2{margin-bottom:.5rem}.mh2{margin-left:.5rem;margin-right:.5rem}.pl3{padding-left:1rem}.pt3{padding-top:1rem}.pb3,.pv3{padding-bottom:1rem}.pv3{padding-top:1rem}.ph3{padding-left:1rem;padding-right:1rem}.mt3{margin-top:1rem}.mb3,.mv3{margin-bottom:1rem}.mv3{margin-top:1rem}.pr4{padding-right:2rem}.pt4{padding-top:2rem}.pb4{padding-bottom:2rem}.ph4{padding-left:2rem;padding-right:2rem}.mt4{margin-top:2rem}.mb4,.mv4{margin-bottom:2rem}.mv4{margin-top:2rem}.mt5{margin-top:4rem}.underline{text-decoration:underline}.no-underline{text-decoration:none}.tc{text-align:center}.ttu{text-transform:uppercase}.f1{font-size:3rem}.f2{font-size:2.25rem}.f3{font-size:1.5rem}.f4{font-size:1.25rem}.f5{font-size:1rem}.f6{font-size:.875rem}.f7{font-size:.75rem}.measure{max-width:30em}.measure-wide{max-width:34em}.measure-narrow{max-width:20em}.v-mid{vertical-align:middle}.o-90{opacity:.9}.sans-serif{font-family:-apple-system,BlinkMacSystemFont,avenir next,avenir,helvetica neue,helvetica,ubuntu,roboto,noto,segoe ui,arial,sans-serif}.code,code{font-family:Consolas,monaco,monospace}.input-reset{-webkit-appearance:none;-moz-appearance:none}.input-reset::-moz-focus-inner{border:0;padding:0}.underline-hover:focus,.underline-hover:hover{text-decoration:underline}.pointer:hover{cursor:pointer}img{max-width:100%}.list{list-style-type:none}.code-light-theme{padding-top:2ch;padding-bottom:2ch;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}.code-light-theme .code{min-width:100%;float:left}.code-light-theme .highlight,.code-light-theme .output,.code-light-theme .standard{padding-left:2ch;padding-right:2ch;display:block;min-width:100%;box-sizing:border-box}.code-light-theme .code .prompt.empty:after{content:"_";-webkit-animation:blinking 1s step-end infinite;-moz-animation:1s blinking step-end infinite;-ms-animation:1s blinking step-end infinite;-o-animation:1s blinking step-end infinite;animation:blinking 1s step-end infinite}.code-dark-theme{padding-top:2ch;padding-bottom:2ch;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}.code-dark-theme .code{min-width:100%;float:left}.code-dark-theme .highlight,.code-dark-theme .output,.code-dark-theme .standard{padding-left:2ch;padding-right:2ch;display:block;min-width:100%;box-sizing:border-box}.code-dark-theme .code .prompt.empty:after{content:"_";-webkit-animation:blinking 1s step-end infinite;-moz-animation:1s blinking step-end infinite;-ms-animation:1s blinking step-end infinite;-o-animation:1s blinking step-end infinite;animation:blinking 1s step-end infinite}@keyframes blinking{0%,to{color:transparent}50%{color:#fff}}.code-light-theme{color:#657b83;background-color:#fdf6e3}.code-light-theme::-moz-selection,.code-light-theme ::-moz-selection{background:#073642}.code-light-theme::selection,.code-light-theme ::selection{background:#073642}.code-light-theme .token.punctuation{color:#586e75}.code-light-theme .token.boolean,.code-light-theme .token.number{color:#268bd2}.code-light-theme .token.builtin,.code-light-theme .token.string{color:#2aa198}.code-light-theme .token.atrule{color:#859900}.code-light-theme .token.class-name{color:#b58900}.code-light-theme .highlight{background:#ffe6c3}.code-dark-theme{color:#f8f8f2;background-color:#272822}.code-dark-theme .token.punctuation{color:#f8f8f2}.code-dark-theme .token.boolean,.code-dark-theme .token.number{color:#ae81ff}.code-dark-theme .token.builtin,.code-dark-theme .token.string{color:#a6e22e}.code-dark-theme .token.atrule,.code-dark-theme .token.class-name{color:#e6db74}.code-dark-theme .highlight{background:#5f6155}.code-dark-theme .code .prompt{text-indent:2ch;position:relative}.code-dark-theme .code .prompt:before{position:absolute;top:0;left:0;content:"$"}@media screen and (min-width:32em){.db-ns{display:block}.flex-ns{display:flex}.items-start-ns{align-items:flex-start}.items-center-ns{align-items:center}.justify-between-ns{justify-content:space-between}.justify-around-ns{justify-content:space-around}.mw4-ns{max-width:8rem}.w-34-ns{width:34%}.w-50-ns{width:50%}.w-60-ns{width:60%}.pt0-ns{padding-top:0}.ph4-ns{padding-left:2rem;padding-right:2rem}.pt5-ns{padding-top:4rem}.f3-ns{font-size:1.5rem}.f4-ns{font-size:1.25rem}}@media screen and (min-width:32em) and (max-width:64em){.pr3-m{padding-right:1rem}.ph4-m{padding-left:2rem;padding-right:2rem}}@media screen and (min-width:64em){.db-l{display:block}.flex-l{display:flex}.justify-center-l{justify-content:center}.mw5-l{max-width:16rem}.mw8-l{max-width:64rem}.mw9-l{max-width:96rem}.w-third-l{width:33.33333%}.w-two-thirds-l{width:66.66667%}.ml3-l{margin-left:1rem}.ph4-l,.pl4-l{padding-left:2rem}.ph4-l{padding-right:2rem}.pb5-l{padding-bottom:4rem}.mt5-l{margin-top:4rem}.mb5-l,.mv5-l{margin-bottom:4rem}.mv5-l{margin-top:4rem}.pr7-l{padding-right:16rem}.f-subheadline-l{font-size:5rem}.f2-l{font-size:2.25rem}.f3-l{font-size:1.5rem}.f4-l{font-size:1.25rem}}.menu{position:relative}.menu__container{position:absolute;top:0;right:0;z-index:999;min-width:18rem;transform:rotateX(-90deg);transform-origin:top center;opacity:.3;transition:all .28s ease-out .24s}.menu:focus-within .menu__container,.menu:hover .menu__container{opacity:1;transform:rotateX(0);visibility:visible}.menu__container{list-style:none;padding-left:0;background:#001c47;color:#fff}.menu__dropdown{padding-bottom:.5rem}.menu__dropdown.menu__dropdown--last{padding-bottom:0}.menu__dropdown__menu{list-style:none;padding-left:0;border-left:.25em solid #fff}.menu__dropdown__button{color:#fff;text-transform:uppercase;padding:.5rem .75rem;font-size:.75rem;opacity:.8;text-decoration:none;display:block}.menu__dropdown__link,.menu__dropdown__menu__item__link{color:#fff;text-transform:uppercase;font-weight:700;text-decoration:none;display:block;padding:1rem;font-size:1rem;opacity:1}.menu__dropdown__button{border:none;background:transparent;outline:none}.menu__dropdown__menu__item__link:hover{background-color:#000814}.menu__dropdown__menu__item:hover .menu__dropdown__menu__item__link:before{content:"·";position:absolute;top:50%;transform:translateY(-50%);left:.25em;color:#fff;line-height:1;font-weight:700}.menu__dropdown__menu__item{border-bottom:1px solid #fff;position:relative}@media screen and (min-width:64em){.menu .hamburger-icon{display:none}.menu{position:static}.menu__container{position:static;top:auto;right:auto;min-width:auto;transform:none;opacity:1;transition:none;display:flex;list-style:none;padding-left:0;margin:0;background:none}.menu:focus-within .menu__container,.menu:hover .menu__container{transform:none}.menu__dropdown{position:relative;border-top:.25rem solid transparent;padding-bottom:0}.menu__dropdown:hover{border-top:.25rem solid #001c47}.menu__dropdown:focus-within{border-top:.25rem solid #001c47}.menu__dropdown__menu__container{position:relative;z-index:999}.menu__dropdown__menu{list-style:none;padding-left:0;margin:0;position:absolute;top:0;left:50%;transform:translateX(-50%) rotateX(-90deg);transform-origin:top center;opacity:.3;transition:all .28s ease-out .24s;background:#001c47;min-width:18rem;border:none;visibility:hidden}.menu__dropdown:hover .menu__dropdown__menu{opacity:1;transform:translateX(-50%) rotateX(0);visibility:visible}.menu__dropdown:focus-within .menu__dropdown__menu{opacity:1;transform:translateX(-50%) rotateX(0);visibility:visible}.menu__dropdown__menu__item__link{padding:1rem}.menu__dropdown--last .menu__dropdown__menu{right:0;left:auto;transform:translateX(0) rotateX(-90deg)}.menu__dropdown.menu__dropdown--last:hover .menu__dropdown__menu{transform:translateX(0) rotateX(0)}.menu__dropdown.menu__dropdown--last:focus-within .menu__dropdown__menu{transform:translateX(0) rotateX(0)}.menu__dropdown__button,.menu__dropdown__link,.menu__dropdown__menu__item__link{color:#fff;text-transform:uppercase;font-weight:700;text-decoration:none;display:block;padding:1rem;font-size:1rem;opacity:1}.menu__dropdown__menu__item.menu__dropdown__menu__item--last{border-bottom:none}}</style></head><body class="bg-near-white sans-serif" tabindex="0"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5WCKPRL" height="0" width="0" style="display: none; visibility: hidden"></iframe></noscript><div class="cf w-100 mw9-l center bg-white"><nav class="nav bg-sky flex items-center justify-between pb1"><a href="/" class="logo db w-40 mw2 mw4-ns ml3-l" title="Learnk8s logo"><div class="flex-ns justify-between-ns items-center-ns"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 62 61" fill="#FFF" class="w-100 w-34-ns min-h-100"><path d="M45.324 32.699a2.264 2.264 0 01-2.262-2.262 2.264 2.264 0 012.262-2.26 2.264 2.264 0 012.261 2.26 2.264 2.264 0 01-2.261 2.262"></path><path d="M45.324 25.35a5.08 5.08 0 00-4.285 2.351c-.734-1.782-1.462-3.82-2.016-5.37-2.044-5.722-3.46-9.445-5.325-10.71a5.07 5.07 0 00-3.638-1.535 5.088 5.088 0 00-5.087 5.088 5.08 5.08 0 002.35 4.285c-1.781.734-3.82 1.462-5.37 2.016-5.722 2.044-9.444 3.46-10.71 5.325a5.088 5.088 0 003.553 8.725 5.08 5.08 0 004.285-2.35c.734 1.781 1.463 3.82 2.017 5.37 2.044 5.721 3.46 9.444 5.325 10.71a5.088 5.088 0 008.725-3.553 5.08 5.08 0 00-2.351-4.285c1.782-.734 3.82-1.463 5.37-2.017 5.722-2.044 9.445-3.46 10.71-5.325a5.07 5.07 0 001.535-3.638 5.088 5.088 0 00-5.088-5.087M33.25 59.882a3.08 3.08 0 01-4.355 0L1.623 32.61a3.08 3.08 0 010-4.356L28.895.982a3.08 3.08 0 014.355 0l27.272 27.272a3.08 3.08 0 010 4.356L33.25 59.882z"></path><path d="M14.797 32.699a2.264 2.264 0 01-2.262-2.262 2.264 2.264 0 012.262-2.26 2.264 2.264 0 012.261 2.26 2.264 2.264 0 01-2.261 2.262M30.06 17.435a2.264 2.264 0 01-2.261-2.261 2.264 2.264 0 012.261-2.26 2.264 2.264 0 012.262 2.26 2.264 2.264 0 01-2.262 2.261M26.507 42.063a5.12 5.12 0 00-.73.901c-.735-1.782-1.464-3.82-2.017-5.37-2.044-5.722-3.46-9.444-5.325-10.71a5.124 5.124 0 00-.901-.731c1.781-.734 3.82-1.463 5.37-2.016 5.721-2.043 9.444-3.46 10.71-5.326.277-.27.521-.572.73-.9.735 1.781 1.463 3.82 2.017 5.37 2.044 5.722 3.46 9.445 5.325 10.71.27.277.573.521.9.73-1.78.735-3.819 1.464-5.37 2.017-5.72 2.044-9.443 3.46-10.71 5.325M30.06 43.44a2.264 2.264 0 012.262 2.261 2.264 2.264 0 01-2.262 2.261 2.264 2.264 0 01-2.261-2.26 2.264 2.264 0 012.261-2.262"></path></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 98 27" fill="#FFF" class="dn db-ns w-60-ns"><path d="M3.04 19.875a1.325 1.325 0 01-.329-.606 3.827 3.827 0 01-.1-.962V2.51l-2.352.405v15.772c0 1.248.305 2.167.911 2.756.606.59 1.634.902 3.084.935l.328-1.971a6.298 6.298 0 01-.935-.19 1.42 1.42 0 01-.607-.341M8.98 14.289c.051-.455.156-.902.316-1.34.16-.439.383-.825.67-1.163a3.38 3.38 0 011.05-.822c.412-.21.888-.315 1.428-.315.96 0 1.714.34 2.262 1.024.547.682.813 1.555.796 2.616H8.98zm3.489-5.637c-.758 0-1.5.143-2.224.429a5.45 5.45 0 00-1.922 1.29c-.556.573-1.002 1.293-1.34 2.16-.337.87-.505 1.883-.505 3.047 0 .994.13 1.908.391 2.743a5.826 5.826 0 001.201 2.16c.54.608 1.226 1.084 2.06 1.429.835.345 1.824.518 2.971.518.91 0 1.722-.084 2.439-.253.716-.168 1.217-.328 1.504-.48l-.328-1.972c-.288.135-.712.274-1.277.417-.565.144-1.26.215-2.085.215-1.466 0-2.545-.354-3.236-1.062-.691-.707-1.087-1.743-1.188-3.109h9c.015-.135.024-.282.024-.442v-.392c0-2.257-.472-3.938-1.415-5.043-.944-1.103-2.3-1.655-4.07-1.655M28.343 20.254a6.332 6.332 0 01-1.074.14c-.43.024-.922.037-1.48.037-.926 0-1.659-.164-2.198-.493-.54-.328-.81-.913-.81-1.756 0-.456.11-.822.33-1.1.219-.278.493-.497.821-.657.328-.16.69-.266 1.087-.316.396-.05.77-.076 1.125-.076.54 0 .999.03 1.378.088.379.06.652.132.821.215v3.918zm1.201-10.199c-.396-.447-.92-.793-1.568-1.037-.649-.245-1.445-.366-2.388-.366-.826 0-1.593.062-2.3.19-.708.126-1.213.256-1.517.391l.278 1.947c.287-.119.72-.232 1.302-.342a11.16 11.16 0 012.035-.164c.607 0 1.1.088 1.478.265.38.177.679.413.898.708.219.296.37.632.455 1.011.084.38.126.762.126 1.15v.658a9.612 9.612 0 00-.354-.077 42.052 42.052 0 00-.593-.113 8.854 8.854 0 00-.721-.101 7.22 7.22 0 00-.733-.037 9.62 9.62 0 00-2.124.226 5.582 5.582 0 00-1.77.709c-.505.32-.905.741-1.2 1.263-.295.523-.442 1.146-.442 1.87 0 .759.127 1.408.38 1.947.252.54.606.974 1.06 1.302.455.329.995.568 1.618.72a8.681 8.681 0 002.048.228c.522 0 1.049-.021 1.58-.063.53-.042 1.024-.089 1.479-.14.454-.05.862-.104 1.226-.163.362-.06.644-.105.847-.14v-8.215c0-.741-.085-1.42-.253-2.035a3.925 3.925 0 00-.847-1.592M40.856 8.841a11.56 11.56 0 00-.772-.1 7.155 7.155 0 00-.695-.039c-1.028 0-1.954.088-2.78.266-.827.177-1.517.366-2.073.569v12.587h2.35V11.078c.136-.033.418-.097.847-.189.43-.092.864-.14 1.302-.14.674 0 1.226.048 1.656.14.43.092.736.173.923.24l.404-2.048a4.38 4.38 0 00-.468-.113 25.081 25.081 0 00-.694-.127M53.785 10.383c-.414-.53-.965-.944-1.656-1.238-.69-.295-1.558-.442-2.604-.442-1.162 0-2.19.075-3.084.227-.893.152-1.609.295-2.148.43v12.765h2.35V11.027c.085-.015.224-.041.418-.074.193-.034.412-.064.657-.09.244-.025.501-.046.771-.062.269-.018.531-.025.783-.025.624 0 1.146.079 1.568.239.421.16.758.417 1.011.77.253.354.433.82.543 1.39.11.574.165 1.265.165 2.074v6.876h2.35v-7.382c0-.892-.084-1.71-.252-2.451-.168-.742-.46-1.378-.872-1.909M68.711 18.25a39.621 39.621 0 00-1.568-1.962 17.506 17.506 0 00-1.566-1.633 73.593 73.593 0 002.793-2.888c.85-.933 1.722-1.912 2.616-2.938h-4.478c-.236.285-.518.62-.846 1.005-.329.385-.678.791-1.049 1.219-.37.427-.753.859-1.148 1.293-.396.437-.779.856-1.149 1.257V2.51l-3.767.606v19.009h3.767v-5.828c.42.339.845.752 1.273 1.242.43.489.837 1 1.225 1.532a36.3 36.3 0 011.097 1.597c.345.532.651 1.018.92 1.457h4.332a28.896 28.896 0 00-2.452-3.874M80.516 18.812c-.404.423-1.046.634-1.922.634-.454 0-.842-.068-1.163-.203a2.434 2.434 0 01-.783-.507 1.914 1.914 0 01-.443-.67 1.928 1.928 0 01-.138-.673c0-.66.16-1.225.48-1.698.32-.473.717-.887 1.188-1.242.472.151.914.317 1.327.495.413.177.771.38 1.075.607.302.228.542.495.72.799.177.303.265.65.265 1.039 0 .523-.202.996-.606 1.419M76.573 8.497a1.93 1.93 0 01.391-.617c.176-.194.4-.35.67-.468.269-.117.59-.176.96-.176.387 0 .717.063.987.19.268.125.493.282.67.465.177.186.303.383.379.593.075.21.113.407.113.592 0 .64-.142 1.176-.43 1.614-.287.437-.699.823-1.238 1.16-.961-.337-1.64-.74-2.035-1.211-.396-.47-.594-.974-.594-1.512 0-.202.041-.411.127-.63m5.56 4.389c.641-.404 1.175-.955 1.606-1.654.43-.698.644-1.45.644-2.259 0-.556-.106-1.115-.316-1.678a4.105 4.105 0 00-1.024-1.527c-.471-.454-1.074-.828-1.807-1.123-.734-.294-1.614-.442-2.642-.442-.876 0-1.672.14-2.389.417a5.767 5.767 0 00-1.832 1.11 4.878 4.878 0 00-1.175 1.628 4.709 4.709 0 00-.418 1.944c0 .891.173 1.624.518 2.196.346.572.881 1.153 1.606 1.742a9.83 9.83 0 00-.948.81c-.295.286-.56.603-.797.948-.236.347-.42.73-.556 1.152a4.563 4.563 0 00-.202 1.393c0 .49.1 1.025.305 1.607a4.305 4.305 0 001.023 1.607c.48.49 1.112.9 1.895 1.228.784.329 1.765.494 2.945.494 1.028 0 1.933-.132 2.718-.393.783-.26 1.436-.628 1.958-1.101a4.56 4.56 0 001.176-1.657c.261-.634.392-1.33.392-2.089 0-.91-.206-1.708-.62-2.392-.413-.683-1.098-1.337-2.06-1.961M96.807 17.03a2.976 2.976 0 00-.657-1.147c-.312-.344-.737-.666-1.277-.962-.54-.297-1.222-.6-2.047-.906a11.68 11.68 0 01-.998-.42 4.127 4.127 0 01-.62-.356.858.858 0 01-.303-.34 1.028 1.028 0 01-.076-.405c0-.657.59-.986 1.77-.986.64 0 1.216.06 1.732.177.513.118.989.253 1.427.405l.657-2.933c-.438-.168-1.028-.324-1.77-.467a12.262 12.262 0 00-2.324-.215c-1.618 0-2.89.362-3.818 1.087-.926.725-1.39 1.71-1.39 2.957 0 .641.092 1.188.278 1.644.186.454.447.846.783 1.175.338.328.747.61 1.227.846.48.237 1.015.465 1.605.683.759.286 1.322.544 1.694.77.37.228.556.493.556.797 0 .388-.143.65-.43.784-.287.135-.775.202-1.467.202a9.55 9.55 0 01-1.996-.215 12.298 12.298 0 01-1.972-.594l-.632 3.058c.303.136.848.304 1.63.506.784.203 1.766.304 2.945.304 1.804 0 3.199-.337 4.184-1.01.986-.672 1.479-1.664 1.479-2.975a5.1 5.1 0 00-.19-1.463"></path></svg></div></a><div class="mw6 menu"><span class="hamburger-icon"></span><ul class="menu__container"><li class="menu__dropdown"><button class="menu__dropdown__button">Training</button><div class="menu__dropdown__menu__container"><ul class="menu__dropdown__menu"><li class="menu__dropdown__menu__item"><a href="/training" class="menu__dropdown__menu__item__link" title="Instructor-led courses">Instructor-led courses</a></li><li class="menu__dropdown__menu__item"><a href="/first-steps" class="menu__dropdown__menu__item__link" title="Kubernetes first steps">Kubernetes first steps</a></li><li class="menu__dropdown__menu__item menu__dropdown__menu__item--last"><a href="/academy" class="menu__dropdown__menu__item__link" title="Learnk8s Academy">Learnk8s Academy</a></li></ul></div></li><li class="menu__dropdown"><button class="menu__dropdown__button">Resources</button><div class="menu__dropdown__menu__container"><ul class="menu__dropdown__menu"><li class="menu__dropdown__menu__item"><a href="/production-best-practices" class="menu__dropdown__menu__item__link" title="Best practices checklist">Best practices checklist</a></li><li class="menu__dropdown__menu__item"><a href="/troubleshooting-deployments" class="menu__dropdown__menu__item__link" title="Troubleshooting flowchart">Troubleshooting flowchart</a></li><li class="menu__dropdown__menu__item"><a href="/research" class="menu__dropdown__menu__item__link" title="Ingress comparison">Ingress comparison</a></li><li class="menu__dropdown__menu__item"><a href="/kubernetes-instance-calculator" class="menu__dropdown__menu__item__link" title="Instance calculator">Instance calculator</a></li><li class="menu__dropdown__menu__item menu__dropdown__menu__item--last"><a href="/kubernetes-resources" class="menu__dropdown__menu__item__link" title="See all">See all</a></li></ul></div></li><li class="menu__dropdown menu__dropdown--last"><a href="/blog" class="menu__dropdown__link" title="Blog">Blog</a></li></ul></div></nav><div class="new-hero pt4 pb5-l pb4"><div class="mw8 center ph3 ph4-ns"><h1 class="f-subheadline-l f1 b white mv0 lh-solid">Kubernetes<br>production<br>best practices</h1><div class="f4 measure"><p class="f2-l f3 white bt bw2 pt3 o-90">A curated checklist of best practices designed to help you release to production</p></div></div></div><div class="mw8 center ph3 ph4-ns mt5-l mt4"><p class="f4-l f5 lh-copy measure">This checklist provides actionable best practices for deploying secure, scalable, and resilient services on Kubernetes.</p><p class="f4-l f5 lh-copy measure">The content is open source and available <a href="https://github.com/learnk8s/kubernetes-production-best-practices" class="link navy underline" target="_blank" rel="noreferrer">in this repository</a>.<br>If you think there are missing best practices or they are not right, consider submitting an issue.</p><p class="f4-l f5 lh-copy b measure">Check things off to keep track as you go.</p></div><div class="flex-l mv5-l mv4 center justify-center-l"><div class="left mw5-l w-third-l ph3 ph4-m pn-l relative"><div class="sticky top-0 left-0 js-left pt3"><div><section class=""><p class="gray ttu f7 mb0">Your progress</p><p class="mt2 mb3 b navy f4 js-progress-percentage">0% complete</p><div class="w-100 relative"><div class="pa1 bg-blue br2 js-active-progress-bar absolute top-0 left-0" style="width: 0px;"></div><div class="pa1 w-100 bg-light-gray br2 br--right js-progress-bar"></div></div></section></div><section><p class="b f3">Categories</p><ul class="list pl0"><li class="mv3"><a href="#application-development" class="pv2 no-underline f5 black-80 hover-navy underline-hover">1. Application development</a></li><li class="mv3"><a href="#governance" class="pv2 no-underline f5 black-80 hover-navy underline-hover">2. Governance</a></li><li class="mv3"><a href="#cluster-configuration" class="pv2 no-underline f5 black-80 hover-navy underline-hover">3. Cluster configuration</a></li></ul></section></div></div><div class="right mw8-l w-two-thirds-l ph3 ph4-m pn-l js-checklist black-80"><div class=""><h2 class="ph4-l f3-l f4-l pb3" id="application-development">1. Application development</h2><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-041019592119282633,.controls-041019592119282633">Health checks</p><div class="controls controls-041019592119282633 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-041019592119282633,.controls-041019592119282633" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-041019592119282633,.controls-041019592119282633"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-041019592119282633 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4"><strong class="b">The readiness probe determines when a container can receive traffic.</strong></p><p class="lh-copy measure-wide f4">The kubelet executes the checks and decides if the app can receive traffic or not.</p><p class="lh-copy measure-wide f4"><strong class="b">The liveness probe determines when a container should be restarted.</strong></p><p class="lh-copy measure-wide f4">The kubelet executes the check and decides if the container should be restarted.</p><p class="lh-copy measure-wide f4"><strong class="b">Resources:</strong></p><ul><li class="lh-copy f4 mv1 measure-wide">The official Kubernetes documentation offers some practical advice on how to <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">configure Liveness, Readiness and Startup Probes</a>.</li><li class="lh-copy f4 mv1 measure-wide"><a href="https://srcco.de/posts/kubernetes-liveness-probes-are-dangerous.html" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Liveness probes are dangerous</a> has some information on how to set (or not) dependencies in your readiness probes.</li></ul></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="containers-have-readiness-probes">Containers have Readiness probes</h3></label><input type="checkbox" name="health-checks-0" id="health-checks-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-health-checks-0,.controls-health-checks-0"></p><h3 class="f3 pt3" id="containers-have-readiness-probes">Containers have Readiness probes</h3><p></p><div class="controls controls-health-checks-0 absolute top-50 right-1"><button class="open dib bg-transparent bn pointer" data-toggle=".details-health-checks-0,.controls-health-checks-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-health-checks-0,.controls-health-checks-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-health-checks-0"><div class="ph4 pt2 pb4"><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Please note that there's no default value for readiness and liveness.</p></blockquote><p class="lh-copy measure-wide f4">If you don't set the readiness probe, the kubelet assumes that the app is ready to receive traffic as soon as the container starts.</p><p class="lh-copy measure-wide f4">If the container takes 2 minutes to start, all the requests to it will fail for those 2 minutes.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="containers-crash-when-there-s-a-fatal-error">Containers crash when there's a fatal error</h3></label><input type="checkbox" name="health-checks-1" id="health-checks-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-health-checks-1,.controls-health-checks-1"></p><h3 class="f3 pt3" id="containers-crash-when-there-s-a-fatal-error">Containers crash when there's a fatal error</h3><p></p><div class="controls controls-health-checks-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-health-checks-1,.controls-health-checks-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-health-checks-1,.controls-health-checks-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-health-checks-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">If the application reaches an unrecoverable error, <a href="https://blog.colinbreck.com/kubernetes-liveness-and-readiness-probes-revisited-how-to-avoid-shooting-yourself-in-the-other-foot/#letitcrash" target="_blank" rel="noreferrer" class="link navy underline hover-sky">you should let it crash</a>.</p><p class="lh-copy measure-wide f4">Examples of such unrecoverable errors are:</p><ul><li class="lh-copy f4 mv1 measure-wide">an uncaught exception</li><li class="lh-copy f4 mv1 measure-wide">a typo in the code (for dynamic languages)</li><li class="lh-copy f4 mv1 measure-wide">unable to load a header or dependency</li></ul><p class="lh-copy measure-wide f4">Please note that you should not signal a failing Liveness probe.</p><p class="lh-copy measure-wide f4">Instead, you should immediately exit the process and let the kubelet restart the container.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="configure-a-passive-liveness-probe">Configure a passive Liveness probe</h3></label><input type="checkbox" name="health-checks-2" id="health-checks-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-health-checks-2,.controls-health-checks-2"></p><h3 class="f3 pt3" id="configure-a-passive-liveness-probe">Configure a passive Liveness probe</h3><p></p><div class="controls controls-health-checks-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-health-checks-2,.controls-health-checks-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-health-checks-2,.controls-health-checks-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-health-checks-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">The Liveness probe is designed to restart your container when it's stuck.</p><p class="lh-copy measure-wide f4">Consider the following scenario: if your application is processing an infinite loop, there's no way to exit or ask for help.</p><p class="lh-copy measure-wide f4">When the process is consuming 100% CPU, it won't have time to reply to the (other) Readiness probe checks, and it will be eventually removed from the Service.</p><p class="lh-copy measure-wide f4">However, the Pod is still registered as an active replica for the current Deployment.</p><p class="lh-copy measure-wide f4">If you don't have a Liveness probe, it stays <em class="i">Running</em> but detached from the Service.</p><p class="lh-copy measure-wide f4">In other words, not only is the process not serving any requests, but it is also consuming resources.</p><p class="lh-copy measure-wide f4"><em class="i">What should you do?</em></p><ol><li class="lh-copy f4 mv1 measure-wide">Expose an endpoint from your app</li><li class="lh-copy f4 mv1 measure-wide">The endpoint always replies with a success response</li><li class="lh-copy f4 mv1 measure-wide">Consume the endpoint from the Liveness probe</li></ol><p class="lh-copy measure-wide f4">Please note that you should not use the Liveness probe to handle fatal errors in your app and request Kubernetes to restart the app.</p><p class="lh-copy measure-wide f4">Instead, you should let the app crash.</p><p class="lh-copy measure-wide f4">The Liveness probe should be used as a recovery mechanism only in case the process is not responsive.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="liveness-probes-values-aren-t-the-same-as-the-readiness">Liveness probes values aren't the same as the Readiness</h3></label><input type="checkbox" name="health-checks-3" id="health-checks-3" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-health-checks-3,.controls-health-checks-3"></p><h3 class="f3 pt3" id="liveness-probes-values-aren-t-the-same-as-the-readiness">Liveness probes values aren't the same as the Readiness</h3><p></p><div class="controls controls-health-checks-3 absolute top-50 right-1"><button class="open dib bg-transparent bn pointer" data-toggle=".details-health-checks-3,.controls-health-checks-3" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-health-checks-3,.controls-health-checks-3" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-health-checks-3"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">When Liveness and Readiness probes are pointing to the same endpoint, the effects of the probes are combined.</p><p class="lh-copy measure-wide f4">When the app signals that it's not ready or live, the kubelet detaches the container from the Service and delete it <strong class="b">at the same time</strong>.</p><p class="lh-copy measure-wide f4">You might notice dropping connections because the container does not have enough time to drain the current connections or process the incoming ones.</p><p class="lh-copy measure-wide f4">You can dig deeper in the following <a href="https://freecontent.manning.com/handling-client-requests-properly-with-kubernetes/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">article that discussed graceful shutdown</a>.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-05712446991881235,.controls-05712446991881235">Apps are independent</p><div class="controls controls-05712446991881235 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-05712446991881235,.controls-05712446991881235" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-05712446991881235,.controls-05712446991881235"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-05712446991881235 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">If the app connects to a database, you might think that returning a failing readiness probe until the database is <em class="i">ready</em> is a good idea — it is not.</p><p class="lh-copy measure-wide f4">Consider the following scenario: you have one front-end app that depends on a backend API.</p><p class="lh-copy measure-wide f4">If the API is flaky (e.g. it's unavailable from time to time due to a bug), the readiness probe fails, and the dependent readiness in the front-end app fail as well.</p><p class="lh-copy measure-wide f4">And you have downtime.</p><p class="lh-copy measure-wide f4">More in general, <strong class="b">a failure in a dependency downstream could propagate to all apps upstream</strong> and eventually, bring down your front-end facing layer as well.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="the-readiness-probes-are-independent">The Readiness probes are independent</h3></label><input type="checkbox" name="apps-are-independent-0" id="apps-are-independent-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-apps-are-independent-0,.controls-apps-are-independent-0"></p><h3 class="f3 pt3" id="the-readiness-probes-are-independent">The Readiness probes are independent</h3><p></p><div class="controls controls-apps-are-independent-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-apps-are-independent-0,.controls-apps-are-independent-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-apps-are-independent-0,.controls-apps-are-independent-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-apps-are-independent-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">The readiness probe doesn't include dependencies to services such as:</p><ul><li class="lh-copy f4 mv1 measure-wide">databases</li><li class="lh-copy f4 mv1 measure-wide">database migrations</li><li class="lh-copy f4 mv1 measure-wide">APIs</li><li class="lh-copy f4 mv1 measure-wide">third party services</li></ul><p class="lh-copy measure-wide f4">You can <a href="https://blog.colinbreck.com/kubernetes-liveness-and-readiness-probes-how-to-avoid-shooting-yourself-in-the-foot/#shootingyourselfinthefootwithreadinessprobes" target="_blank" rel="noreferrer" class="link navy underline hover-sky">explore what happens when there're dependencies in the readiness probes in this essay</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="the-app-retries-connecting-to-dependent-services">The app retries connecting to dependent services</h3></label><input type="checkbox" name="apps-are-independent-1" id="apps-are-independent-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-apps-are-independent-1,.controls-apps-are-independent-1"></p><h3 class="f3 pt3" id="the-app-retries-connecting-to-dependent-services">The app retries connecting to dependent services</h3><p></p><div class="controls controls-apps-are-independent-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-apps-are-independent-1,.controls-apps-are-independent-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-apps-are-independent-1,.controls-apps-are-independent-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-apps-are-independent-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">When the app starts, it shouldn't crash because a dependency such as a database isn't ready.</p><p class="lh-copy measure-wide f4">Instead, the app should keep retrying to connect to the database until it succeeds.</p><p class="lh-copy measure-wide f4">Kubernetes expects that application components can be started in any order.</p><p class="lh-copy measure-wide f4">When you make sure that your app can reconnect to a dependency such as a database you know you can deliver a more robust and resilient service.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-027813431436559366,.controls-027813431436559366">Graceful shutdown</p><div class="controls controls-027813431436559366 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-027813431436559366,.controls-027813431436559366" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-027813431436559366,.controls-027813431436559366"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-027813431436559366 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Instead, you should wait for the existing connection to drain and stop processing new ones.</p><p class="lh-copy measure-wide f4">Please notice that, when a Pod is terminated, the endpoints for that Pod are removed from the Service.</p><p class="lh-copy measure-wide f4">However, it might take some time before component such as kube-proxy or the Ingress controller is notified of the change.</p><p class="lh-copy measure-wide f4">You can find a detail explanation on how graceful shutdown works in <a href="https://freecontent.manning.com/handling-client-requests-properly-with-kubernetes/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">handling client requests correctly with Kubernetes</a>.</p><p class="lh-copy measure-wide f4">The correct graceful shutdown sequence is:</p><ol><li class="lh-copy f4 mv1 measure-wide">upon receiving SIGTERM</li><li class="lh-copy f4 mv1 measure-wide">the server stops accepting new connections</li><li class="lh-copy f4 mv1 measure-wide">completes all active requests</li><li class="lh-copy f4 mv1 measure-wide">then immediately kills all keepalive connections and</li><li class="lh-copy f4 mv1 measure-wide">the process exits</li></ol><p class="lh-copy measure-wide f4">You can <a href="https://github.com/mikkeloscar/kube-sigterm-test" target="_blank" rel="noreferrer" class="link navy underline hover-sky">test that your app gracefully shuts down with this tool: kube-sigterm-test</a>.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="the-app-doesn-t-shut-down-on-sigterm-but-it-gracefully-terminates-connections">The app doesn't shut down on SIGTERM, but it gracefully terminates connections</h3></label><input type="checkbox" name="graceful-shutdown-0" id="graceful-shutdown-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-graceful-shutdown-0,.controls-graceful-shutdown-0"></p><h3 class="f3 pt3" id="the-app-doesn-t-shut-down-on-sigterm-but-it-gracefully-terminates-connections">The app doesn't shut down on SIGTERM, but it gracefully terminates connections</h3><p></p><div class="controls controls-graceful-shutdown-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-graceful-shutdown-0,.controls-graceful-shutdown-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-graceful-shutdown-0,.controls-graceful-shutdown-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-graceful-shutdown-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">It might take some time before a component such as kube-proxy or the Ingress controller is notified of the endpoint changes.</p><p class="lh-copy measure-wide f4">Hence, traffic might still flow to the Pod despite it being marked as terminated.</p><p class="lh-copy measure-wide f4">The app should stop accepting new requests on all remaining connections, and close these once the outgoing queue is drained.</p><p class="lh-copy measure-wide f4">If you need a refresher on how endpoints are propagated in your cluster, <a href="https://freecontent.manning.com/handling-client-requests-properly-with-kubernetes/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">read this article on how to handle client requests properly</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="the-app-still-processes-incoming-requests-in-the-grace-period">The app still processes incoming requests in the grace period</h3></label><input type="checkbox" name="graceful-shutdown-1" id="graceful-shutdown-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-graceful-shutdown-1,.controls-graceful-shutdown-1"></p><h3 class="f3 pt3" id="the-app-still-processes-incoming-requests-in-the-grace-period">The app still processes incoming requests in the grace period</h3><p></p><div class="controls controls-graceful-shutdown-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-graceful-shutdown-1,.controls-graceful-shutdown-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-graceful-shutdown-1,.controls-graceful-shutdown-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-graceful-shutdown-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">You might want to consider using the container lifecycle events such as <a href="https://kubernetes.io/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/#define-poststart-and-prestop-handlers" target="_blank" rel="noreferrer" class="link navy underline hover-sky">the preStop handler</a> to customize what happens before a Pod is deleted.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="the-cmd-in-the-dockerfile-forwards-the-sigterm-to-the-process">The CMD in the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">Dockerfile</code> forwards the SIGTERM to the process</h3></label><input type="checkbox" name="graceful-shutdown-2" id="graceful-shutdown-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-graceful-shutdown-2,.controls-graceful-shutdown-2"></p><h3 class="f3 pt3" id="the-cmd-in-the-dockerfile-forwards-the-sigterm-to-the-process">The CMD in the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">Dockerfile</code> forwards the SIGTERM to the process</h3><p></p><div class="controls controls-graceful-shutdown-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-graceful-shutdown-2,.controls-graceful-shutdown-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-graceful-shutdown-2,.controls-graceful-shutdown-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-graceful-shutdown-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">You can be notified when the Pod is about to be terminated by capturing the SIGTERM signal in your app.</p><p class="lh-copy measure-wide f4">You should also pay attention to <a href="https://pracucci.com/graceful-shutdown-of-kubernetes-pods.html" target="_blank" rel="noreferrer" class="link navy underline hover-sky">forwarding the signal to the right process in your container</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="close-all-idle-keep-alive-sockets">Close all idle keep-alive sockets</h3></label><input type="checkbox" name="graceful-shutdown-3" id="graceful-shutdown-3" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-graceful-shutdown-3,.controls-graceful-shutdown-3"></p><h3 class="f3 pt3" id="close-all-idle-keep-alive-sockets">Close all idle keep-alive sockets</h3><p></p><div class="controls controls-graceful-shutdown-3 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-graceful-shutdown-3,.controls-graceful-shutdown-3" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-graceful-shutdown-3,.controls-graceful-shutdown-3" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-graceful-shutdown-3 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">If the calling app is not closing the TCP connection (e.g. using TCP keep-alive or a connection pool) it will connect to one Pod and not use the other Pods in that Service.</p><p class="lh-copy measure-wide f4"><em class="i">But what happens when a Pod is deleted?</em></p><p class="lh-copy measure-wide f4">Ideally, the request should go to another Pod.</p><p class="lh-copy measure-wide f4">However, the calling app has a long-lived connection open with the Pod that is about to be terminated, and it will keep using it.</p><p class="lh-copy measure-wide f4">On the other hand, you shouldn't abruptly terminate long-lived connections.</p><p class="lh-copy measure-wide f4">Instead, you should terminate them before shutting down the app.</p><p class="lh-copy measure-wide f4">You can read about keep-alive connections on this article about <a href="http://dillonbuchanan.com/programming/gracefully-shutting-down-a-nodejs-http-server/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">gracefully shutting down a Nodejs HTTP server</a>.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-07425421975086446,.controls-07425421975086446">Fault tolerance</p><div class="controls controls-07425421975086446 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-07425421975086446,.controls-07425421975086446" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-07425421975086446,.controls-07425421975086446"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-07425421975086446 toggle-collapse"><div class="ph4 pt2 pb4"><ul><li class="lh-copy f4 mv1 measure-wide">a hardware failure of the physical machine</li><li class="lh-copy f4 mv1 measure-wide">cloud provider or hypervisor failure</li><li class="lh-copy f4 mv1 measure-wide">a kernel panic</li></ul><p class="lh-copy measure-wide f4">Pods deployed in those nodes are lost too.</p><p class="lh-copy measure-wide f4">Also, there are other scenarios where Pods could be deleted:</p><ul><li class="lh-copy f4 mv1 measure-wide">directly deleting a pod (accident)</li><li class="lh-copy f4 mv1 measure-wide">draining a node</li><li class="lh-copy f4 mv1 measure-wide">removing a pod from a node to permit another Pod to fit on that node</li></ul><p class="lh-copy measure-wide f4">Any of the above scenarios could affect the availability of your app and potentially cause downtime.</p><p class="lh-copy measure-wide f4">You should protect from a scenario where all of your Pods are made unavailable, and you aren't able to serve live traffic.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="run-more-than-one-replica-for-your-deployment">Run more than one replica for your Deployment</h3></label><input type="checkbox" name="fault-tolerance-0" id="fault-tolerance-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-fault-tolerance-0,.controls-fault-tolerance-0"></p><h3 class="f3 pt3" id="run-more-than-one-replica-for-your-deployment">Run more than one replica for your Deployment</h3><p></p><div class="controls controls-fault-tolerance-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-fault-tolerance-0,.controls-fault-tolerance-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-fault-tolerance-0,.controls-fault-tolerance-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-fault-tolerance-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Never run a single Pod individually.</p><p class="lh-copy measure-wide f4">Instead consider deploying your Pod as part of a Deployment, DaemonSet, ReplicaSet or StatefulSet.</p><p class="lh-copy measure-wide f4"><a href="https://cloudmark.github.io/Node-Management-In-GKE/#replicas" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Running more than one instance of your Pods guarantees that deleting a single Pod won't cause downtime</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="avoid-pods-being-placed-into-a-single-node">Avoid Pods being placed into a single node</h3></label><input type="checkbox" name="fault-tolerance-1" id="fault-tolerance-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-fault-tolerance-1,.controls-fault-tolerance-1"></p><h3 class="f3 pt3" id="avoid-pods-being-placed-into-a-single-node">Avoid Pods being placed into a single node</h3><p></p><div class="controls controls-fault-tolerance-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-fault-tolerance-1,.controls-fault-tolerance-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-fault-tolerance-1,.controls-fault-tolerance-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-fault-tolerance-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4"><strong class="b">Even if you run several copies of your Pods, there are no guarantees that losing a node won't take down your service.</strong></p><p class="lh-copy measure-wide f4">Consider the following scenario: you have 11 replicas on a single cluster node.</p><p class="lh-copy measure-wide f4">If the node is made unavailable, the 11 replicas are lost, and you have downtime.</p><p class="lh-copy measure-wide f4"><a href="https://cloudmark.github.io/Node-Management-In-GKE/#pod-anti-affinity-rules" target="_blank" rel="noreferrer" class="link navy underline hover-sky">You should apply anti-affinity rules to your Deployments so that Pods are spread in all the nodes of your cluster</a>.</p><p class="lh-copy measure-wide f4">The <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity" target="_blank" rel="noreferrer" class="link navy underline hover-sky">inter-pod affinity and anti-affinity</a> documentation describe how you can you could change your Pod to be located (or not) in the same node.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="set-pod-disruption-budgets">Set Pod disruption budgets</h3></label><input type="checkbox" name="fault-tolerance-2" id="fault-tolerance-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-fault-tolerance-2,.controls-fault-tolerance-2"></p><h3 class="f3 pt3" id="set-pod-disruption-budgets">Set Pod disruption budgets</h3><p></p><div class="controls controls-fault-tolerance-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-fault-tolerance-2,.controls-fault-tolerance-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-fault-tolerance-2,.controls-fault-tolerance-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-fault-tolerance-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">When a node is drained, all the Pods on that node are deleted and rescheduled.</p><p class="lh-copy measure-wide f4"><em class="i">But what if you are under heavy load and you can't lose more than 50% of your Pods?</em></p><p class="lh-copy measure-wide f4">The drain event could affect your availability.</p><p class="lh-copy measure-wide f4">To protect the Deployments from unexpected events that could take down several Pods at the same time, you can define Pod Disruption Budget.</p><p class="lh-copy measure-wide f4">Imagine saying: <em class="i">"Kubernetes, please make sure that there are always at least 5 Pods running for my app".</em></p><p class="lh-copy measure-wide f4">Kubernetes will prevent the drain event if the final state results in less than 5 Pods for that Deployment.</p><p class="lh-copy measure-wide f4">The official documentation is an excellent place to start to understand <a href="https://kubernetes.io/docs/concepts/workloads/pods/disruptions/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Pod Disruption Budgets</a>.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-08296450587351052,.controls-08296450587351052">Resources utilisation</p><div class="controls controls-08296450587351052 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-08296450587351052,.controls-08296450587351052" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-08296450587351052,.controls-08296450587351052"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-08296450587351052 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Docker containers are the blocks; servers are the boards, and the scheduler is the player.</p><img class="db pv3 center" src="https://learnk8s.io/a/07f667b9d423bdbcc0efe183928e0a4c.svg" alt="Kubernetes is the best Tetris player"><p class="lh-copy measure-wide f4">To maximise the efficiency of the scheduler, you should share with Kubernetes details such as resource utilisation, workload priorities and overheads.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="set-memory-limits-and-requests-for-all-containers">Set memory limits and requests for all containers</h3></label><input type="checkbox" name="resources-utilisation-0" id="resources-utilisation-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-resources-utilisation-0,.controls-resources-utilisation-0"></p><h3 class="f3 pt3" id="set-memory-limits-and-requests-for-all-containers">Set memory limits and requests for all containers</h3><p></p><div class="controls controls-resources-utilisation-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-0,.controls-resources-utilisation-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-0,.controls-resources-utilisation-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-resources-utilisation-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Resource limits are used to constrain how much CPU and memory your containers can utilise and are set using the resources property of a <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">containerSpec</code>.</p><p class="lh-copy measure-wide f4">The scheduler uses those as one of metrics to decide which node is best suited for the current Pod.</p><p class="lh-copy measure-wide f4">A container without a memory limit has memory utilisation of zero — according to the scheduler.</p><p class="lh-copy measure-wide f4">An unlimited number of Pods if schedulable on any nodes leading to resource overcommitment and potential node (and kubelet) crashes.</p><p class="lh-copy measure-wide f4">The same applies to CPU limits.</p><p class="lh-copy measure-wide f4"><em class="i">But should you always set limits and requests for memory and CPU?</em></p><p class="lh-copy measure-wide f4">Yes and no.</p><p class="lh-copy measure-wide f4">If your process goes over the memory limit, the process is terminated.</p><p class="lh-copy measure-wide f4">Since CPU is a compressible resource, if your container goes over the limit, the process is throttled.</p><p class="lh-copy measure-wide f4">Even if it could have used some of the CPU that was available at that moment.</p><p class="lh-copy measure-wide f4"><strong class="b"><a href="https://www.reddit.com/r/kubernetes/comments/cmp7jj/multithreading_in_a_container_with_limited/ew52fcj/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">CPU limits are hard.</a></strong></p><p class="lh-copy measure-wide f4">If you wish to dig deeper into CPU and memory limits you should check out the following articles:</p><ul><li class="lh-copy f4 mv1 measure-wide"><a href="https://medium.com/@betz.mark/understanding-resource-limits-in-kubernetes-memory-6b41e9a955f9" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Understanding resource limits in kubernetes: memory</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="https://medium.com/@betz.mark/understanding-resource-limits-in-kubernetes-cpu-time-9eff74d3161b" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Understanding resource limits in kubernetes: cpu time</a></li></ul><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Please note that if you are not sure what should be the <em class="i">right</em> CPU or memory limit, you can use the <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Vertical Pod Autoscaler</a> in Kubernetes with the recommendation mode turned on. The autoscaler profiles your app and recommends limits for it.</p></blockquote></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="set-cpu-request-to-1-cpu-or-below">Set CPU request to 1 CPU or below</h3></label><input type="checkbox" name="resources-utilisation-1" id="resources-utilisation-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-resources-utilisation-1,.controls-resources-utilisation-1"></p><h3 class="f3 pt3" id="set-cpu-request-to-1-cpu-or-below">Set CPU request to 1 CPU or below</h3><p></p><div class="controls controls-resources-utilisation-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-1,.controls-resources-utilisation-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-1,.controls-resources-utilisation-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-resources-utilisation-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Unless you have computational intensive jobs, <a href="https://www.youtube.com/watch?v=xjpHggHKm78" target="_blank" rel="noreferrer" class="link navy underline hover-sky">it is recommended to set the request to 1 CPU or below</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="disable-cpu-limits-unless-you-have-a-good-use-case">Disable CPU limits — unless you have a good use case</h3></label><input type="checkbox" name="resources-utilisation-2" id="resources-utilisation-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-resources-utilisation-2,.controls-resources-utilisation-2"></p><h3 class="f3 pt3" id="disable-cpu-limits-unless-you-have-a-good-use-case">Disable CPU limits — unless you have a good use case</h3><p></p><div class="controls controls-resources-utilisation-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-2,.controls-resources-utilisation-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-2,.controls-resources-utilisation-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-resources-utilisation-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">CPU is measured as CPU timeunits per timeunit.</p><p class="lh-copy measure-wide f4"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">cpu: 1</code> means 1 CPU second per second.</p><p class="lh-copy measure-wide f4">If you have 1 thread, you can't consume more than 1 CPU second per second.</p><p class="lh-copy measure-wide f4">If you have 2 threads, you can consume 1 CPU second in 0.5 seconds.</p><p class="lh-copy measure-wide f4">8 threads can consume 1 CPU second in 0.125 seconds.</p><p class="lh-copy measure-wide f4">After that, your process is throttled.</p><p class="lh-copy measure-wide f4">If you're not sure about what's the best settings for your app, it's better not to set the CPU limits.</p><p class="lh-copy measure-wide f4">If you wish to learn more, <a href="https://medium.com/@betz.mark/understanding-resource-limits-in-kubernetes-cpu-time-9eff74d3161b" target="_blank" rel="noreferrer" class="link navy underline hover-sky">this article digs deeper in CPU requests and limits</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="the-namespace-has-a-limitrange">The namespace has a LimitRange</h3></label><input type="checkbox" name="resources-utilisation-3" id="resources-utilisation-3" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-resources-utilisation-3,.controls-resources-utilisation-3"></p><h3 class="f3 pt3" id="the-namespace-has-a-limitrange">The namespace has a LimitRange</h3><p></p><div class="controls controls-resources-utilisation-3 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-3,.controls-resources-utilisation-3" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-3,.controls-resources-utilisation-3" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-resources-utilisation-3 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">If you think you might forget to set memory and CPU limits, you should consider using a LimitRange object to define the standard size for a container deployed in the current namespace.</p><p class="lh-copy measure-wide f4"><a href="https://kubernetes.io/docs/concepts/policy/limit-range/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">The official documentation about LimitRange</a> is an excellent place to start.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="set-an-appropriate-quality-of-service-qos-for-pods">Set an appropriate Quality of Service (QoS) for Pods</h3></label><input type="checkbox" name="resources-utilisation-4" id="resources-utilisation-4" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-resources-utilisation-4,.controls-resources-utilisation-4"></p><h3 class="f3 pt3" id="set-an-appropriate-quality-of-service-qos-for-pods">Set an appropriate Quality of Service (QoS) for Pods</h3><p></p><div class="controls controls-resources-utilisation-4 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-4,.controls-resources-utilisation-4" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-resources-utilisation-4,.controls-resources-utilisation-4" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-resources-utilisation-4 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">When a node goes into an overcommitted state (i.e. using too many resources) Kubernetes tries to evict some of the Pod in that Node.</p><p class="lh-copy measure-wide f4">Kubernetes ranks and evicts the Pods according to a well-defined logic.</p><p class="lh-copy measure-wide f4">You can find more about <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">configuring the quality of service for your Pods</a> on the official documentation.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-08189674298397231,.controls-08189674298397231">Tagging resources</p><div class="controls controls-08189674298397231 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-08189674298397231,.controls-08189674298397231" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-08189674298397231,.controls-08189674298397231"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-08189674298397231 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">A label is a key-value pair without any pre-defined meaning.</p><p class="lh-copy measure-wide f4">They can be applied to all resources in your cluster from Pods to Service, Ingress manifests, Endpoints, etc.</p><p class="lh-copy measure-wide f4">You can use labels to categorize resources by purpose, owner, environment, or other criteria.</p><p class="lh-copy measure-wide f4">So you could choose a label to tag a Pod in an environment such as "this pod is running in production" or "the payment team owns that Deployment".</p><p class="lh-copy measure-wide f4">You can also omit labels altogether.</p><p class="lh-copy measure-wide f4">However, you might want to consider using labels to cover the following categories:</p><ul><li class="lh-copy f4 mv1 measure-wide">technical labels such as the environment</li><li class="lh-copy f4 mv1 measure-wide">labels for automation</li><li class="lh-copy f4 mv1 measure-wide">label related to your business such as cost-centre allocation</li><li class="lh-copy f4 mv1 measure-wide">label related to security such as compliance requirements</li></ul></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="resources-have-technical-labels-defined">Resources have technical labels defined</h3></label><input type="checkbox" name="tagging-resources-0" id="tagging-resources-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-tagging-resources-0,.controls-tagging-resources-0"></p><h3 class="f3 pt3" id="resources-have-technical-labels-defined">Resources have technical labels defined</h3><p></p><div class="controls controls-tagging-resources-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-tagging-resources-0,.controls-tagging-resources-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-tagging-resources-0,.controls-tagging-resources-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-tagging-resources-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">You could tag your Pods with:</p><ul><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">name</code>, the name of the application such "User API"</li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">instance</code>, a unique name identifying the instance of an application (you could use the container image tag)</li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">version</code>, the current version of the appl (an incremental counter)</li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">component</code>, the component within the architecture such as "API" or "database"</li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">part-of</code>, the name of a higher-level application this one is part of such as "payment gateway"</li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">managed-by</code>, the tool being used to manage the operation of an application such as "kubectl" or "Helm"</li></ul><p class="lh-copy measure-wide f4">Here's an example on how you could use such labels in a Deployment:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">deployment.yaml</p></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
</span><span class="highlight">    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>api
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>api<span class="token punctuation">-</span>5fa65d2
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> <span class="token string">"42"</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> api
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> payment<span class="token punctuation">-</span>gateway
    <span class="token key atrule">app.kubernetes.io/managed-by</span><span class="token punctuation">:</span> kubectl
</span><span class="standard"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">application</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
</span><span class="highlight">        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>api
        <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>api<span class="token punctuation">-</span>5fa65d2
        <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> <span class="token string">"42"</span>
        <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> api
        <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> payment<span class="token punctuation">-</span>gateway
</span><span class="standard">    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp</span></code></pre></div><p class="lh-copy measure-wide f4">Those labels are <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">recommended by the official documentation</a>.</p><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Please note that you're recommended to tag <strong class="b">all resources</strong>.</p></blockquote></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="resources-have-business-labels-defined">Resources have business labels defined</h3></label><input type="checkbox" name="tagging-resources-1" id="tagging-resources-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-tagging-resources-1,.controls-tagging-resources-1"></p><h3 class="f3 pt3" id="resources-have-business-labels-defined">Resources have business labels defined</h3><p></p><div class="controls controls-tagging-resources-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-tagging-resources-1,.controls-tagging-resources-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-tagging-resources-1,.controls-tagging-resources-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-tagging-resources-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">You could tag your Pods with:</p><ul><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">owner</code>, used to identify who is responsible for the resource</li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">project</code>, used to determine the project that the resource belongs to</li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">business-unit</code>, used to identify the cost centre or business unit associated with a resource; typically for cost allocation and tracking</li></ul><p class="lh-copy measure-wide f4">Here's an example on how you could use such labels in a Deployment:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">deployment.yaml</p></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
</span><span class="highlight">    <span class="token key atrule">owner</span><span class="token punctuation">:</span> payment<span class="token punctuation">-</span>team
    <span class="token key atrule">project</span><span class="token punctuation">:</span> fraud<span class="token punctuation">-</span>detection
    <span class="token key atrule">business-unit</span><span class="token punctuation">:</span> <span class="token string">"80432"</span>
</span><span class="standard"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">application</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
</span><span class="highlight">        <span class="token key atrule">owner</span><span class="token punctuation">:</span> payment<span class="token punctuation">-</span>team
        <span class="token key atrule">project</span><span class="token punctuation">:</span> fraud<span class="token punctuation">-</span>detection
        <span class="token key atrule">business-unit</span><span class="token punctuation">:</span> <span class="token string">"80432"</span>
</span><span class="standard">    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp</span></code></pre></div><p class="lh-copy measure-wide f4">You can explore labels and <a href="https://aws.amazon.com/answers/account-management/aws-tagging-strategies/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">tagging for resources on the AWS tagging strategy page</a>.</p><p class="lh-copy measure-wide f4">The article isn't specific to Kubernetes but explores some of the most common strategies for tagging resources.</p><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Please not that you're recommended to tag <strong class="b">all resources</strong>.</p></blockquote></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="resources-have-security-labels-defined">Resources have security labels defined</h3></label><input type="checkbox" name="tagging-resources-2" id="tagging-resources-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-tagging-resources-2,.controls-tagging-resources-2"></p><h3 class="f3 pt3" id="resources-have-security-labels-defined">Resources have security labels defined</h3><p></p><div class="controls controls-tagging-resources-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-tagging-resources-2,.controls-tagging-resources-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-tagging-resources-2,.controls-tagging-resources-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-tagging-resources-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">You could tag your Pods with:</p><ul><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">confidentiality</code>, an identifier for the specific data-confidentiality level a resource supports</li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">compliance</code>, an identifier for workloads designed to adhere to specific compliance requirements</li></ul><p class="lh-copy measure-wide f4">Here's an example on how you could use such labels in a Deployment:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">deployment.yaml</p></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
</span><span class="highlight">    <span class="token key atrule">confidentiality</span><span class="token punctuation">:</span> official
    <span class="token key atrule">compliance</span><span class="token punctuation">:</span> pci
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
</span><span class="standard">      <span class="token key atrule">application</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">confidentiality</span><span class="token punctuation">:</span> official
        <span class="token key atrule">compliance</span><span class="token punctuation">:</span> pci
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
</span><span class="highlight">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp</span></code></pre></div><p class="lh-copy measure-wide f4">You can explore label and <a href="https://aws.amazon.com/answers/account-management/aws-tagging-strategies/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">tagging for resources on the AWS tagging strategy page</a>.</p><p class="lh-copy measure-wide f4">The article isn't specific to Kubernetes but explores some of the most common strategies for tagging resources.</p><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Please not that you're recommended to tag <strong class="b">all resources</strong>.</p></blockquote></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-08669223599915361,.controls-08669223599915361">Logging</p><div class="controls controls-08669223599915361 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-08669223599915361,.controls-08669223599915361" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-08669223599915361,.controls-08669223599915361"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-08669223599915361 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">The logs are particularly useful for debugging problems and monitoring app activity.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="the-application-logs-to-stdout-and-stderr">The application logs to <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">stdout</code> and <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">stderr</code></h3></label><input type="checkbox" name="logging-0" id="logging-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-logging-0,.controls-logging-0"></p><h3 class="f3 pt3" id="the-application-logs-to-stdout-and-stderr">The application logs to <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">stdout</code> and <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">stderr</code></h3><p></p><div class="controls controls-logging-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-logging-0,.controls-logging-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-logging-0,.controls-logging-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-logging-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">There are two logging strategies: <em class="i">passive</em> and <em class="i">active</em>.</p><p class="lh-copy measure-wide f4">Apps that use passive logging are unaware of the logging infrastructure and log messages to standard outputs.</p><p class="lh-copy measure-wide f4">This best practice is part of <a href="https://12factor.net/logs" target="_blank" rel="noreferrer" class="link navy underline hover-sky">the twelve-factor app</a>.</p><p class="lh-copy measure-wide f4">In active logging, the app makes network connections to intermediate aggregators, sends data to third-party logging services, or writes directly to a database or index.</p><p class="lh-copy measure-wide f4">Active logging is considered an antipattern, and it should be avoided.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="avoid-sidecars-for-logging-if-you-can-">Avoid sidecars for logging (if you can)</h3></label><input type="checkbox" name="logging-1" id="logging-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-logging-1,.controls-logging-1"></p><h3 class="f3 pt3" id="avoid-sidecars-for-logging-if-you-can-">Avoid sidecars for logging (if you can)</h3><p></p><div class="controls controls-logging-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-logging-1,.controls-logging-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-logging-1,.controls-logging-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-logging-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">If you wish to <a href="https://rclayton.silvrback.com/container-services-logging-with-docker#effective-logging-infrastructure" target="_blank" rel="noreferrer" class="link navy underline hover-sky">apply log transformations to an application with a non-standard log event model</a>, you may want to use a sidecar container.</p><p class="lh-copy measure-wide f4">With a sidecar container, you can normalise the log entries before they are shipped elsewhere.</p><p class="lh-copy measure-wide f4">For example, you may want to transform Apache logs into Logstash JSON format before shipping it to the logging infrastructure.</p><p class="lh-copy measure-wide f4">However, if you have control over the application, you could output the right format, to begin with.</p><p class="lh-copy measure-wide f4">You could save on running an extra container for each Pod in your cluster.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-02811842317222517,.controls-02811842317222517">Scaling</p><div class="controls controls-02811842317222517 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-02811842317222517,.controls-02811842317222517" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-02811842317222517,.controls-02811842317222517"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-02811842317222517 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Containers have a local filesystem and you might be tempted to use it for persisting data.</p><p class="lh-copy measure-wide f4">However, storing persistent data in a container's local filesystem prevents the encompassing Pod from being scaled horizontally (that is, by adding or removing replicas of the Pod).</p><p class="lh-copy measure-wide f4">This is because, by using the local filesystem, each container maintains its own "state", which means that the states of Pod replicas may diverge over time. This results in inconsistent behaviour from the user's point of view (for example, a specific piece of user information is available when the request hits one Pod, but not when the request hits another Pod).</p><p class="lh-copy measure-wide f4">Instead, any persistent information should be saved at a central place outside the Pods. For example, in a PersistentVolume in the cluster, or even better in some storage service outside the cluster.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="containers-do-not-store-any-state-in-their-local-filesystem">Containers do not store any state in their local filesystem</h3></label><input type="checkbox" name="scaling-0" id="scaling-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-scaling-0,.controls-scaling-0"></p><h3 class="f3 pt3" id="containers-do-not-store-any-state-in-their-local-filesystem">Containers do not store any state in their local filesystem</h3><p></p><div class="controls controls-scaling-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-scaling-0,.controls-scaling-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-scaling-0,.controls-scaling-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-scaling-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Containers have a local filesystem and you might be tempted to use it for persisting data.</p><p class="lh-copy measure-wide f4">However, storing persistent data in a container's local filesystem prevents the encompassing Pod from being scaled horizontally (that is, by adding or removing replicas of the Pod).</p><p class="lh-copy measure-wide f4">This is because, by using the local filesystem, each container maintains its own "state", which means that the states of Pod replicas may diverge over time. This results in inconsistent behaviour from the user's point of view (for example, a specific piece of user information is available when the request hits one Pod, but not when the request hits another Pod).</p><p class="lh-copy measure-wide f4">Instead, any persistent information should be saved at a central place outside the Pods. For example, in a PersistentVolume in the cluster, or even better in some storage service outside the cluster.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="use-the-horizontal-pod-autoscaler-for-apps-with-variable-usage-patterns">Use the Horizontal Pod Autoscaler for apps with variable usage patterns</h3></label><input type="checkbox" name="scaling-1" id="scaling-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-scaling-1,.controls-scaling-1"></p><h3 class="f3 pt3" id="use-the-horizontal-pod-autoscaler-for-apps-with-variable-usage-patterns">Use the Horizontal Pod Autoscaler for apps with variable usage patterns</h3><p></p><div class="controls controls-scaling-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-scaling-1,.controls-scaling-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-scaling-1,.controls-scaling-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-scaling-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">The <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Horizontal Pod Autoscaler (HPA)</a> is a built-in Kubernetes feature that monitors your application and automatically adds or removes Pod replicas based on the current usage.</p><p class="lh-copy measure-wide f4">Configuring the HPA allows your app to stay available and responsive under any traffic conditions, including unexpected spikes.</p><p class="lh-copy measure-wide f4">To configure the HPA to autoscale your app, you have to create a <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.16/#horizontalpodautoscaler-v1-autoscaling" target="_blank" rel="noreferrer" class="link navy underline hover-sky">HorizontalPodAutoscaler</a> resource, which defines what metric to monitor for your app.</p><p class="lh-copy measure-wide f4">The HPA can monitor either built-in resource metric (CPU and memory usage of your Pods) or custom metrics. In the case of custom metrics, you are also responsible for collecting and exposing these metrics, which you can do, for example, with <a href="https://prometheus.io/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Prometheus</a> and the <a href="https://github.com/DirectXMan12/k8s-prometheus-adapter" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Prometheus Adapter</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="don-t-use-the-vertical-pod-autoscaler-while-it-s-still-in-beta">Don't use the Vertical Pod Autoscaler while it's still in beta</h3></label><input type="checkbox" name="scaling-2" id="scaling-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-scaling-2,.controls-scaling-2"></p><h3 class="f3 pt3" id="don-t-use-the-vertical-pod-autoscaler-while-it-s-still-in-beta">Don't use the Vertical Pod Autoscaler while it's still in beta</h3><p></p><div class="controls controls-scaling-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-scaling-2,.controls-scaling-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-scaling-2,.controls-scaling-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-scaling-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Analogous to the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Horizontal Pod Autoscaler (HPA)</a>, there exists the <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Vertical Pod Autoscaler (VPA)</a>.</p><p class="lh-copy measure-wide f4">The VPA can automatically adapt the resource requests and limits of your Pods so that when a Pod needs more resources, it can get them (increasing/decreasing the resources of a single Pod is called <em class="i">vertical scaling</em>, as opposed to <em class="i">horizontal scaling</em>, which means increasing/decreasing the number of replicas of a Pod).</p><p class="lh-copy measure-wide f4">This can be useful for scaling applications that can't be scaled horizontally.</p><p class="lh-copy measure-wide f4">However, the VPA is curently in beta and it has <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler#limitations-of-beta-version" target="_blank" rel="noreferrer" class="link navy underline hover-sky">some known limitations</a> (for example, scaling a Pod by changing its resource requirements, requires the Pod to be killed and restarted).</p><p class="lh-copy measure-wide f4">Given these limitations, and the fact that most applications on Kubernetes can be scaled horizontally anyway, it is recommended to not use the VPA in production (at least until there is a stable version).</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="use-the-cluster-autoscaler-if-you-have-highly-varying-workloads">Use the Cluster Autoscaler if you have highly varying workloads</h3></label><input type="checkbox" name="scaling-3" id="scaling-3" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-scaling-3,.controls-scaling-3"></p><h3 class="f3 pt3" id="use-the-cluster-autoscaler-if-you-have-highly-varying-workloads">Use the Cluster Autoscaler if you have highly varying workloads</h3><p></p><div class="controls controls-scaling-3 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-scaling-3,.controls-scaling-3" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-scaling-3,.controls-scaling-3" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-scaling-3 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">The <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Cluster Autoscaler</a> is another type of "autoscaler" (besides the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Horizontal Pod Autoscaler</a> and <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Vertical Pod Autoscaler</a>).</p><p class="lh-copy measure-wide f4">The Cluster Autoscaler can automatically scale the size of your cluster by adding or removing worker nodes.</p><p class="lh-copy measure-wide f4">A scale-up operation happens when a Pod fails to be scheduled because of insufficient resources on the existing worker nodes. In this case, the Cluster Autoscaler creates a new worker node, so that the Pod can be scheduled. Similarly, when the utilisation of the existing worker nodes is low, the Cluster Autoscaler can scale down by evicting all the workloads from one of the worker nodes and removing it.</p><p class="lh-copy measure-wide f4">Using the Cluster Autoscaler makes sense for highly variable workloads, for example, when the number of Pods may multiply in a short time, and then go back to the previous value. In such scenarios, the Cluster Autoscaler allows you to meet the demand spikes without wasting resources by overprovisioning worker nodes.</p><p class="lh-copy measure-wide f4">However, if your workloads do not vary so much, it may not be worth to set up the Cluster Autoscaler, as it may never be triggered. If your workloads grow slowly and monotonically, it may be enough to monitor the utilisations of your existing worker nodes and add an additional worker node manually when they reach a critical value.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-0025721622865283678,.controls-0025721622865283678">Configuration and secrets</p><div class="controls controls-0025721622865283678 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-0025721622865283678,.controls-0025721622865283678" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-0025721622865283678,.controls-0025721622865283678"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-0025721622865283678 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Configuration should be maintained outside the application code.</p><p class="lh-copy measure-wide f4">This has several benefits. First, changing the configuration does not require recompiling the application. Second, the configuration can be updated when the application is running. Third, the same code can be used in different environments.</p><p class="lh-copy measure-wide f4">In Kubernetes, the configuration can be saved in ConfigMaps, which can then be mounted into containers as volumes are passed in as environment variables.</p><p class="lh-copy measure-wide f4">Save only non-sensitive configuration in ConfigMaps. For sensitive information (such as credentials), use the Secret resource.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="externalise-all-configuration">Externalise all configuration</h3></label><input type="checkbox" name="configuration-and-secrets-0" id="configuration-and-secrets-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-configuration-and-secrets-0,.controls-configuration-and-secrets-0"></p><h3 class="f3 pt3" id="externalise-all-configuration">Externalise all configuration</h3><p></p><div class="controls controls-configuration-and-secrets-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-configuration-and-secrets-0,.controls-configuration-and-secrets-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-configuration-and-secrets-0,.controls-configuration-and-secrets-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-configuration-and-secrets-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Configuration should be maintained outside the application code.</p><p class="lh-copy measure-wide f4">This has several benefits. First, changing the configuration does not require recompiling the application. Second, the configuration can be updated when the application is running. Third, the same code can be used in different environments.</p><p class="lh-copy measure-wide f4">In Kubernetes, the configuration can be saved in ConfigMaps, which can then be mounted into containers as volumes are passed in as environment variables.</p><p class="lh-copy measure-wide f4">Save only non-sensitive configuration in ConfigMaps. For sensitive information (such as credentials), use the Secret resource.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="mount-secrets-as-volumes-not-enviroment-variables">Mount Secrets as volumes, not enviroment variables</h3></label><input type="checkbox" name="configuration-and-secrets-1" id="configuration-and-secrets-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-configuration-and-secrets-1,.controls-configuration-and-secrets-1"></p><h3 class="f3 pt3" id="mount-secrets-as-volumes-not-enviroment-variables">Mount Secrets as volumes, not enviroment variables</h3><p></p><div class="controls controls-configuration-and-secrets-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-configuration-and-secrets-1,.controls-configuration-and-secrets-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-configuration-and-secrets-1,.controls-configuration-and-secrets-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-configuration-and-secrets-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">The content of Secret resources should be mounted into containers as volumes rather than passed in as environment variables.</p><p class="lh-copy measure-wide f4">This is to prevent that the secret values appear in the command that was used to start the container, which may be inspected by individuals that shouldn't have access to the secret values.</p></div></div></div></li></ul></section></div><div class="mt5"><h2 class="ph4-l f3-l f4-l pb3" id="governance">2. Governance</h2><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-04052077712650779,.controls-04052077712650779">Namespace limits</p><div class="controls controls-04052077712650779 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-04052077712650779,.controls-04052077712650779" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-04052077712650779,.controls-04052077712650779"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-04052077712650779 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">You shouldn't allow your user to use more resources than what you agreed in advance.</p><p class="lh-copy measure-wide f4">Cluster administrators can set constraints to limit the number of objects or amount of computing resources that are used in your project with quotas and limit ranges.</p><p class="lh-copy measure-wide f4">You should check out the official documentation if you need a refresher on <a href="https://kubernetes.io/docs/concepts/policy/limit-range/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">limit ranges</a></p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="namespaces-have-limitrange">Namespaces have LimitRange</h3></label><input type="checkbox" name="namespace-limits-0" id="namespace-limits-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-namespace-limits-0,.controls-namespace-limits-0"></p><h3 class="f3 pt3" id="namespaces-have-limitrange">Namespaces have LimitRange</h3><p></p><div class="controls controls-namespace-limits-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-namespace-limits-0,.controls-namespace-limits-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-namespace-limits-0,.controls-namespace-limits-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-namespace-limits-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Containers without limits can lead to resource contention with other containers and unoptimized consumption of computing resources.</p><p class="lh-copy measure-wide f4">Kubernetes has two features for constraining resource utilisation: ResourceQuota and LimitRange.</p><p class="lh-copy measure-wide f4">With the LimitRange object, you can define default values for resource requests and limits for individual containers inside namespaces.</p><p class="lh-copy measure-wide f4">Any container created inside that namespace, without request and limit values explicitly specified, is assigned the default values.</p><p class="lh-copy measure-wide f4">You should check out the official documentation if you need a refresher on <a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">resource quotas</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="namespaces-have-resourcequotas">Namespaces have ResourceQuotas</h3></label><input type="checkbox" name="namespace-limits-1" id="namespace-limits-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-namespace-limits-1,.controls-namespace-limits-1"></p><h3 class="f3 pt3" id="namespaces-have-resourcequotas">Namespaces have ResourceQuotas</h3><p></p><div class="controls controls-namespace-limits-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-namespace-limits-1,.controls-namespace-limits-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-namespace-limits-1,.controls-namespace-limits-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-namespace-limits-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">With ResourceQuotas, you can limit the total resource consumption of all containers inside a Namespace.</p><p class="lh-copy measure-wide f4">Defining a resource quota for a namespace limits the total amount of CPU, memory or storage resources that can be consumed by all containers belonging to that namespace.</p><p class="lh-copy measure-wide f4">You can also set quotas for other Kubernetes objects such as the number of Pods in the current namespace.</p><p class="lh-copy measure-wide f4">If you're thinking that someone could exploit your cluster and create 20000 ConfigMaps, using the LimitRange is how you can prevent that.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-08570897254467733,.controls-08570897254467733">Pod security policies</p><div class="controls controls-08570897254467733 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-08570897254467733,.controls-08570897254467733" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-08570897254467733,.controls-08570897254467733"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-08570897254467733 toggle-collapse"><div class="ph4 pt2 pb4"><ul><li class="lh-copy f4 mv1 measure-wide">the container being compromised</li><li class="lh-copy f4 mv1 measure-wide">the container using resources on the node that are not allowed such as process, network or file system</li></ul><p class="lh-copy measure-wide f4">More in general, you should restrict what the Pod can do to the bare minimum.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="enable-pod-security-policies">Enable Pod Security Policies</h3></label><input type="checkbox" name="pod-security-policies-0" id="pod-security-policies-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-pod-security-policies-0,.controls-pod-security-policies-0"></p><h3 class="f3 pt3" id="enable-pod-security-policies">Enable Pod Security Policies</h3><p></p><div class="controls controls-pod-security-policies-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-0,.controls-pod-security-policies-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-0,.controls-pod-security-policies-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-pod-security-policies-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">For example, you can use Kubernetes Pod security policies for restricting:</p><ul><li class="lh-copy f4 mv1 measure-wide">Access the host process or network namespace</li><li class="lh-copy f4 mv1 measure-wide">Running privileged containers</li><li class="lh-copy f4 mv1 measure-wide">The user that the container is running as</li><li class="lh-copy f4 mv1 measure-wide">Access the host filesystem</li><li class="lh-copy f4 mv1 measure-wide">Linux capabilities, Seccomp or SELinux profiles</li></ul><p class="lh-copy measure-wide f4">Choosing the right policy depends on the nature of your cluster.</p><p class="lh-copy measure-wide f4">The following article explains some of the <a href="https://resources.whitesourcesoftware.com/blog-whitesource/kubernetes-pod-security-policy" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Kubernetes Pod Security Policy best practices</a></p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="disable-privileged-containers">Disable privileged containers</h3></label><input type="checkbox" name="pod-security-policies-1" id="pod-security-policies-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-pod-security-policies-1,.controls-pod-security-policies-1"></p><h3 class="f3 pt3" id="disable-privileged-containers">Disable privileged containers</h3><p></p><div class="controls controls-pod-security-policies-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-1,.controls-pod-security-policies-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-1,.controls-pod-security-policies-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-pod-security-policies-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">In a Pod, containers can run in "privileged" mode and have almost unrestricted access to resources on the host system.</p><p class="lh-copy measure-wide f4">While there are specific use cases where this level of access is necessary, in general, it's a security risk to let your containers do this.</p><p class="lh-copy measure-wide f4">Valid uses cases for privileged Pods include using hardware on the node such as GPUs.</p><p class="lh-copy measure-wide f4">You can <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">learn more about security contexts and privileges containers from this article</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="use-a-read-only-filesystem-in-containers">Use a read-only filesystem in containers</h3></label><input type="checkbox" name="pod-security-policies-2" id="pod-security-policies-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-pod-security-policies-2,.controls-pod-security-policies-2"></p><h3 class="f3 pt3" id="use-a-read-only-filesystem-in-containers">Use a read-only filesystem in containers</h3><p></p><div class="controls controls-pod-security-policies-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-2,.controls-pod-security-policies-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-2,.controls-pod-security-policies-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-pod-security-policies-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Running a read-only file system in your containers forces your containers to be immutable.</p><p class="lh-copy measure-wide f4">Not only does this mitigate some old (and risky) practices such as hot patching, but also helps you prevent the risks of malicious processes storing or manipulating data inside a container.</p><p class="lh-copy measure-wide f4">Running containers with a read-only file system might sound straightforward, but it might come with some complexity.</p><p class="lh-copy measure-wide f4"><em class="i">What if you need to write logs or store files in a temporary folder?</em></p><p class="lh-copy measure-wide f4">You can learn about the trade-offs in this article on <a href="https://medium.com/@axbaretto/running-docker-containers-securely-in-production-98b8104ef68" target="_blank" rel="noreferrer" class="link navy underline hover-sky">running containers securely in production</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="prevent-containers-from-running-as-root">Prevent containers from running as root</h3></label><input type="checkbox" name="pod-security-policies-3" id="pod-security-policies-3" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-pod-security-policies-3,.controls-pod-security-policies-3"></p><h3 class="f3 pt3" id="prevent-containers-from-running-as-root">Prevent containers from running as root</h3><p></p><div class="controls controls-pod-security-policies-3 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-3,.controls-pod-security-policies-3" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-3,.controls-pod-security-policies-3" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-pod-security-policies-3 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">A process running in a container is no different from any other process on the host, except it has a small piece of metadata that declares that it's in a container.</p><p class="lh-copy measure-wide f4">Hence, root in a container is the same root (uid 0) as on the host machine.</p><p class="lh-copy measure-wide f4">If a user manages to break out of an application running as root in a container, they may be able to gain access to the host with the same root user.</p><p class="lh-copy measure-wide f4">Configuring containers to use unprivileged users, is the best way to prevent privilege escalation attacks.</p><p class="lh-copy measure-wide f4">If you wish to learn more, the follow <a href="https://medium.com/@mccode/processes-in-containers-should-not-run-as-root-2feae3f0df3b" target="_blank" rel="noreferrer" class="link navy underline hover-sky">article offers some detailed explanation examples of what happens when you run your containers as root</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="limit-capabilities">Limit capabilities</h3></label><input type="checkbox" name="pod-security-policies-4" id="pod-security-policies-4" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-pod-security-policies-4,.controls-pod-security-policies-4"></p><h3 class="f3 pt3" id="limit-capabilities">Limit capabilities</h3><p></p><div class="controls controls-pod-security-policies-4 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-4,.controls-pod-security-policies-4" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-4,.controls-pod-security-policies-4" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-pod-security-policies-4 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Linux capabilities give processes the ability to do some of the many privileged operations only the root user can do by default.</p><p class="lh-copy measure-wide f4">For example, <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">CAP_CHOWN</code> allows a process to "make arbitrary changes to file UIDs and GIDs".</p><p class="lh-copy measure-wide f4">Even if your process doesn't run as <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">root</code>, there's a chance that a process could use those root-like features by escalating privileges.</p><p class="lh-copy measure-wide f4">In other words, you should enable only the capabilities that you need if you don't want to be compromised.</p><p class="lh-copy measure-wide f4"><em class="i">But what capabilities should be enabled and why?</em></p><p class="lh-copy measure-wide f4">The following two articles dive into the theory and practical best-practices about capabilities in the Linux Kernel:</p><ul><li class="lh-copy f4 mv1 measure-wide"><a href="https://blog.container-solutions.com/linux-capabilities-why-they-exist-and-how-they-work" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Linux Capabilities: Why They Exist and How They Work</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="https://blog.container-solutions.com/linux-capabilities-in-practice" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Linux Capabilities In Practice</a></li></ul></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="prevent-privilege-escalation">Prevent privilege escalation</h3></label><input type="checkbox" name="pod-security-policies-5" id="pod-security-policies-5" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-pod-security-policies-5,.controls-pod-security-policies-5"></p><h3 class="f3 pt3" id="prevent-privilege-escalation">Prevent privilege escalation</h3><p></p><div class="controls controls-pod-security-policies-5 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-5,.controls-pod-security-policies-5" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-pod-security-policies-5,.controls-pod-security-policies-5" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-pod-security-policies-5 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">You should run your container with privilege escalation turned off to prevent escalating privileges using <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">setuid</code> or <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">setgid</code> binaries.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-07168971352935318,.controls-07168971352935318">Network policies</p><div class="controls controls-07168971352935318 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-07168971352935318,.controls-07168971352935318" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-07168971352935318,.controls-07168971352935318"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-07168971352935318 toggle-collapse"><div class="ph4 pt2 pb4"><ol><li class="lh-copy f4 mv1 measure-wide"><strong class="b">containers can talk to any other container in the network</strong>, and there's no translation of addresses in the process — i.e. no NAT is involved</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">nodes in the cluster can talk to any other container in the network and vice-versa</strong>. Even in this case, there's no translation of addresses — i.e. no NAT</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">a container's IP address is always the same</strong>, independently if seen from another container or itself.</li></ol><p class="lh-copy measure-wide f4">The first rule isn't helping if you plan to segregate your cluster in smaller chunks and have isolation between namespaces.</p><p class="lh-copy measure-wide f4"><em class="i">Imagine if a user in your cluster were able to use any other service in the cluster.</em></p><p class="lh-copy measure-wide f4">Now, <em class="i">imagine if a malicious user in the cluster were to obtain access to the cluster</em> — they could make requests to the whole cluster.</p><p class="lh-copy measure-wide f4">To fix that, you can define how Pods should be allowed to communicate in the current namespace and cross-namespace using Network Policies.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="enable-network-policies">Enable network policies</h3></label><input type="checkbox" name="network-policies-0" id="network-policies-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-network-policies-0,.controls-network-policies-0"></p><h3 class="f3 pt3" id="enable-network-policies">Enable network policies</h3><p></p><div class="controls controls-network-policies-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-network-policies-0,.controls-network-policies-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-network-policies-0,.controls-network-policies-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-network-policies-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Kubernetes network policies specify the access permissions for groups of pods, much like security groups in the cloud are used to control access to VM instances.</p><p class="lh-copy measure-wide f4">In other words, it creates firewalls between pods running on a Kubernetes cluster.</p><p class="lh-copy measure-wide f4">If you are not familiar with Network Policies, you can read <a href="https://ahmet.im/blog/kubernetes-network-policy/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Securing Kubernetes Cluster Networking</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="there-s-a-conservative-networkpolicy-in-every-namespace">There's a conservative NetworkPolicy in every namespace</h3></label><input type="checkbox" name="network-policies-1" id="network-policies-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-network-policies-1,.controls-network-policies-1"></p><h3 class="f3 pt3" id="there-s-a-conservative-networkpolicy-in-every-namespace">There's a conservative NetworkPolicy in every namespace</h3><p></p><div class="controls controls-network-policies-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-network-policies-1,.controls-network-policies-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-network-policies-1,.controls-network-policies-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-network-policies-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">This repository contains various use cases of Kubernetes Network Policies and samples YAML files to leverage in your setup. If you ever wondered <a href="https://github.com/ahmetb/kubernetes-network-policy-recipes" target="_blank" rel="noreferrer" class="link navy underline hover-sky">how to drop/restrict traffic to applications running on Kubernetes</a>, read on.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-012455456846204416,.controls-012455456846204416">Role-Based Access Control (RBAC) policies</p><div class="controls controls-012455456846204416 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-012455456846204416,.controls-012455456846204416" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-012455456846204416,.controls-012455456846204416"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-012455456846204416 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">It's common practice to give away the least permission needed, <em class="i">but what is practical and how do you quantify the least privilege?</em></p><p class="lh-copy measure-wide f4">Fine-grained policies provide greater security but require more effort to administrate.</p><p class="lh-copy measure-wide f4">Broader grants can give unnecessary API access to service accounts but are easier to controls.</p><p class="lh-copy measure-wide f4"><em class="i">Should you create a single policy per namespace and share it?</em></p><p class="lh-copy measure-wide f4"><em class="i">Or perhaps it's better to have them on a more granular basis?</em></p><p class="lh-copy measure-wide f4">There's no one-size-fits-all approach, and you should judge your requirements case by case.</p><p class="lh-copy measure-wide f4"><em class="i">But where do you start?</em></p><p class="lh-copy measure-wide f4">If you start with a Role with empty rules, you can add all the resources that you need one by one and still be sure that you're not giving away too much.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="disable-auto-mounting-of-the-default-serviceaccount">Disable auto-mounting of the default ServiceAccount</h3></label><input type="checkbox" name="role-based-access-control-rbac-policies-0" id="role-based-access-control-rbac-policies-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-role-based-access-control-rbac-policies-0,.controls-role-based-access-control-rbac-policies-0"></p><h3 class="f3 pt3" id="disable-auto-mounting-of-the-default-serviceaccount">Disable auto-mounting of the default ServiceAccount</h3><p></p><div class="controls controls-role-based-access-control-rbac-policies-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-role-based-access-control-rbac-policies-0,.controls-role-based-access-control-rbac-policies-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-role-based-access-control-rbac-policies-0,.controls-role-based-access-control-rbac-policies-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-role-based-access-control-rbac-policies-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Please note that <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server" target="_blank" rel="noreferrer" class="link navy underline hover-sky">the default ServiceAccount is automatically mounted into the file system of all Pods</a>.</p><p class="lh-copy measure-wide f4">You might want to disable that and provide more granular policies.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="rbac-policies-are-set-to-the-least-amount-of-privileges-necessary">RBAC policies are set to the least amount of privileges necessary</h3></label><input type="checkbox" name="role-based-access-control-rbac-policies-1" id="role-based-access-control-rbac-policies-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-role-based-access-control-rbac-policies-1,.controls-role-based-access-control-rbac-policies-1"></p><h3 class="f3 pt3" id="rbac-policies-are-set-to-the-least-amount-of-privileges-necessary">RBAC policies are set to the least amount of privileges necessary</h3><p></p><div class="controls controls-role-based-access-control-rbac-policies-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-role-based-access-control-rbac-policies-1,.controls-role-based-access-control-rbac-policies-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-role-based-access-control-rbac-policies-1,.controls-role-based-access-control-rbac-policies-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-role-based-access-control-rbac-policies-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">It's challenging to find good advice on how to set up your RBAC rules. In <a href="https://thenewstack.io/three-realistic-approaches-to-kubernetes-rbac/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">3 realistic approaches to Kubernetes RBAC</a>, you can find three practical scenarios and practical advice on how to get started.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="rbac-policies-are-granular-and-not-shared">RBAC policies are granular and not shared</h3></label><input type="checkbox" name="role-based-access-control-rbac-policies-2" id="role-based-access-control-rbac-policies-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-role-based-access-control-rbac-policies-2,.controls-role-based-access-control-rbac-policies-2"></p><h3 class="f3 pt3" id="rbac-policies-are-granular-and-not-shared">RBAC policies are granular and not shared</h3><p></p><div class="controls controls-role-based-access-control-rbac-policies-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-role-based-access-control-rbac-policies-2,.controls-role-based-access-control-rbac-policies-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-role-based-access-control-rbac-policies-2,.controls-role-based-access-control-rbac-policies-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-role-based-access-control-rbac-policies-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Zalando has a concise policy to define roles and ServiceAccounts.</p><p class="lh-copy measure-wide f4">First, they describe their requirements:</p><ul><li class="lh-copy f4 mv1 measure-wide">Users should be able to deploy, but they shouldn't be allowed to read Secrets for example</li><li class="lh-copy f4 mv1 measure-wide">Admins should get full access to all resources</li><li class="lh-copy f4 mv1 measure-wide">Applications should not gain write access to the Kubernetes API by default</li><li class="lh-copy f4 mv1 measure-wide">It should be possible to write to the Kubernetes API for some uses.</li></ul><p class="lh-copy measure-wide f4">The four requirements translate into five separate Roles:</p><ul><li class="lh-copy f4 mv1 measure-wide">ReadOnly</li><li class="lh-copy f4 mv1 measure-wide">PowerUser</li><li class="lh-copy f4 mv1 measure-wide">Operator</li><li class="lh-copy f4 mv1 measure-wide">Controller</li><li class="lh-copy f4 mv1 measure-wide">Admin</li></ul><p class="lh-copy measure-wide f4">You can read about <a href="https://kubernetes-on-aws.readthedocs.io/en/latest/dev-guide/arch/access-control/adr-004-roles-and-service-accounts.html" target="_blank" rel="noreferrer" class="link navy underline hover-sky">their decision in this link</a>.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-08531792694957128,.controls-08531792694957128">Custom policies</p><div class="controls controls-08531792694957128 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-08531792694957128,.controls-08531792694957128" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-08531792694957128,.controls-08531792694957128"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-08531792694957128 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">As an example, you might want to avoid downloading containers from the public internet and prefer to approve those containers first.</p><p class="lh-copy measure-wide f4">Perhaps you have an internal registry, and only the images in this registry can be deployed in your cluster.</p><p class="lh-copy measure-wide f4"><em class="i">How do you enforce that only <strong class="b">trusted containers</strong> can be deployed in the cluster?</em></p><p class="lh-copy measure-wide f4">There's no RBAC policy for that.</p><p class="lh-copy measure-wide f4">Network policies won't work.</p><p class="lh-copy measure-wide f4"><em class="i">What should you do?</em></p><p class="lh-copy measure-wide f4">You could use the <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Admission controller</a> to vet resources that are submitted to the cluster.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="allow-deploying-containers-only-from-known-registries">Allow deploying containers only from known registries</h3></label><input type="checkbox" name="custom-policies-0" id="custom-policies-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-custom-policies-0,.controls-custom-policies-0"></p><h3 class="f3 pt3" id="allow-deploying-containers-only-from-known-registries">Allow deploying containers only from known registries</h3><p></p><div class="controls controls-custom-policies-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-custom-policies-0,.controls-custom-policies-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-custom-policies-0,.controls-custom-policies-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-custom-policies-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">One of the most common custom policies that you might want to consider is to restrict the images that can be deployed in your cluster.</p><p class="lh-copy measure-wide f4"><a href="https://blog.openpolicyagent.org/securing-the-kubernetes-api-with-open-policy-agent-ce93af0552c3#3c6e" target="_blank" rel="noreferrer" class="link navy underline hover-sky">The following tutorial explains how you can use the Open Policy Agent to restrict not approved images</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="enforce-uniqueness-in-ingress-hostnames">Enforce uniqueness in Ingress hostnames</h3></label><input type="checkbox" name="custom-policies-1" id="custom-policies-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-custom-policies-1,.controls-custom-policies-1"></p><h3 class="f3 pt3" id="enforce-uniqueness-in-ingress-hostnames">Enforce uniqueness in Ingress hostnames</h3><p></p><div class="controls controls-custom-policies-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-custom-policies-1,.controls-custom-policies-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-custom-policies-1,.controls-custom-policies-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-custom-policies-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">When a user creates an Ingress manifest, they can use any hostname in it.</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">ingress.yaml</p></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>ingress
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="highlight">    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> first.example.com
</span><span class="standard">      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
            <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">service</span><span class="token punctuation">:</span>
                <span class="token key atrule">name</span><span class="token punctuation">:</span> service
                <span class="token key atrule">port</span><span class="token punctuation">:</span>
                  <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">80</span></span></code></pre></div><p class="lh-copy measure-wide f4">However, you might want to prevent users using <strong class="b">the same hostname multiple times</strong> and overriding each other.</p><p class="lh-copy measure-wide f4">The official documentation for the Open Policy Agent has <a href="https://www.openpolicyagent.org/docs/latest/kubernetes-tutorial/#4-define-a-policy-and-load-it-into-opa-via-kubernetes" target="_blank" rel="noreferrer" class="link navy underline hover-sky">a tutorial on how to check Ingress resources as part of the validation webhook</a>.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="only-use-approved-domain-names-in-the-ingress-hostnames">Only use approved domain names in the Ingress hostnames</h3></label><input type="checkbox" name="custom-policies-2" id="custom-policies-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-custom-policies-2,.controls-custom-policies-2"></p><h3 class="f3 pt3" id="only-use-approved-domain-names-in-the-ingress-hostnames">Only use approved domain names in the Ingress hostnames</h3><p></p><div class="controls controls-custom-policies-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-custom-policies-2,.controls-custom-policies-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-custom-policies-2,.controls-custom-policies-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-custom-policies-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">When a user creates an Ingress manifest, they can use any hostname in it.
a</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">ingress.yaml</p></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>ingress
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="highlight">    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> first.example.com
</span><span class="standard">      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
            <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">service</span><span class="token punctuation">:</span>
                <span class="token key atrule">name</span><span class="token punctuation">:</span> service
                <span class="token key atrule">port</span><span class="token punctuation">:</span>
                  <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">80</span></span></code></pre></div><p class="lh-copy measure-wide f4">However, you might want to prevent users using <strong class="b">invalid hostnames</strong>.</p><p class="lh-copy measure-wide f4">The official documentation for the Open Policy Agent has <a href="https://www.openpolicyagent.org/docs/latest/kubernetes-tutorial/#4-define-a-policy-and-load-it-into-opa-via-kubernetes" target="_blank" rel="noreferrer" class="link navy underline hover-sky">a tutorial on how to check Ingress resources as part of the validation webhook</a>.</p></div></div></div></li></ul></section></div><div class="mt5"><h2 class="ph4-l f3-l f4-l pb3" id="cluster-configuration">3. Cluster configuration</h2><div class="ph4-l"><p class="pl3 bl bw2 b--blue bg-evian pv3 ph4 lh-copy f4-l f5">This section is a work in progress. Do you have an opinion on what you should be included?<br><a href="https://github.com/learnk8s/kubernetes-production-best-practices/issues" class="link navy underline" target="_blank" rel="noreferrer">File an issue.</a></p></div><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-01644472999367903,.controls-01644472999367903">Approved Kubernetes configuration</p><div class="controls controls-01644472999367903 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-01644472999367903,.controls-01644472999367903" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-01644472999367903,.controls-01644472999367903"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-01644472999367903 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">But how do you know what's the recommended configuration for your cluster?</p><p class="lh-copy measure-wide f4">The best option is to compare your cluster with a standard reference.</p><p class="lh-copy measure-wide f4">In the case of Kubernetes, the reference is the Centre for Internet Security (CIS) benchmark.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="the-cluster-passes-the-cis-benchmark">The cluster passes the CIS benchmark</h3></label><input type="checkbox" name="approved-kubernetes-configuration-0" id="approved-kubernetes-configuration-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-approved-kubernetes-configuration-0,.controls-approved-kubernetes-configuration-0"></p><h3 class="f3 pt3" id="the-cluster-passes-the-cis-benchmark">The cluster passes the CIS benchmark</h3><p></p><div class="controls controls-approved-kubernetes-configuration-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-approved-kubernetes-configuration-0,.controls-approved-kubernetes-configuration-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-approved-kubernetes-configuration-0,.controls-approved-kubernetes-configuration-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-approved-kubernetes-configuration-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">The Center for Internet Security provides several guidelines and benchmark tests for best practices in securing your code.</p><p class="lh-copy measure-wide f4">They also maintain a benchmark for Kubernetes which you can <a href="https://www.cisecurity.org/benchmark/kubernetes/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">download from the official website</a>.</p><p class="lh-copy measure-wide f4">While you can read the lengthy guide and manually check if your cluster is compliant, an easier way is to download and execute <a href="https://github.com/aquasecurity/kube-bench" target="_blank" rel="noreferrer" class="link navy underline hover-sky"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">kube-bench</code></a>.</p><p class="lh-copy measure-wide f4"><a href="https://github.com/aquasecurity/kube-bench" target="_blank" rel="noreferrer" class="link navy underline hover-sky"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">kube-bench</code></a> is a tool designed to automate the CIS Kubernetes benchmark and report on misconfigurations in your cluster.</p><p class="lh-copy measure-wide f4">Example output:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="output"><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token number">1</span> Master Node Security Configuration
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token number">1.1</span> API Server
<span class="token punctuation">[</span>WARN<span class="token punctuation">]</span> <span class="token number">1.1</span>.1 Ensure that the --anonymous-auth argument is <span class="token builtin class-name">set</span> to <span class="token boolean">false</span> <span class="token punctuation">(</span>Not Scored<span class="token punctuation">)</span>
<span class="token punctuation">[</span>PASS<span class="token punctuation">]</span> <span class="token number">1.1</span>.2 Ensure that the --basic-auth-file argument is not <span class="token builtin class-name">set</span> <span class="token punctuation">(</span>Scored<span class="token punctuation">)</span>
<span class="token punctuation">[</span>PASS<span class="token punctuation">]</span> <span class="token number">1.1</span>.3 Ensure that the --insecure-allow-any-token argument is not <span class="token builtin class-name">set</span> <span class="token punctuation">(</span>Not Scored<span class="token punctuation">)</span>
<span class="token punctuation">[</span>PASS<span class="token punctuation">]</span> <span class="token number">1.1</span>.4 Ensure that the --kubelet-https argument is <span class="token builtin class-name">set</span> to <span class="token boolean">true</span> <span class="token punctuation">(</span>Scored<span class="token punctuation">)</span>
<span class="token punctuation">[</span>PASS<span class="token punctuation">]</span> <span class="token number">1.1</span>.5 Ensure that the --insecure-bind-address argument is not <span class="token builtin class-name">set</span> <span class="token punctuation">(</span>Scored<span class="token punctuation">)</span>
<span class="token punctuation">[</span>PASS<span class="token punctuation">]</span> <span class="token number">1.1</span>.6 Ensure that the --insecure-port argument is <span class="token builtin class-name">set</span> to <span class="token number">0</span> <span class="token punctuation">(</span>Scored<span class="token punctuation">)</span>
<span class="token punctuation">[</span>PASS<span class="token punctuation">]</span> <span class="token number">1.1</span>.7 Ensure that the --secure-port argument is not <span class="token builtin class-name">set</span> to <span class="token number">0</span> <span class="token punctuation">(</span>Scored<span class="token punctuation">)</span>
<span class="token punctuation">[</span>FAIL<span class="token punctuation">]</span> <span class="token number">1.1</span>.8 Ensure that the --profiling argument is <span class="token builtin class-name">set</span> to <span class="token boolean">false</span> <span class="token punctuation">(</span>Scored<span class="token punctuation">)</span></span><span class="output prompt mt3 empty"></span></code></pre></div><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Please note that it is not possible to inspect the master nodes of managed clusters such as GKE, EKS and AKS, using <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal">kube-bench</code>. The master nodes are controlled and managed by the cloud provider.</p></blockquote></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="disable-metadata-cloud-providers-metadata-api">Disable metadata cloud providers metadata API</h3></label><input type="checkbox" name="approved-kubernetes-configuration-1" id="approved-kubernetes-configuration-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-approved-kubernetes-configuration-1,.controls-approved-kubernetes-configuration-1"></p><h3 class="f3 pt3" id="disable-metadata-cloud-providers-metadata-api">Disable metadata cloud providers metadata API</h3><p></p><div class="controls controls-approved-kubernetes-configuration-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-approved-kubernetes-configuration-1,.controls-approved-kubernetes-configuration-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-approved-kubernetes-configuration-1,.controls-approved-kubernetes-configuration-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-approved-kubernetes-configuration-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Cloud platforms (AWS, Azure, GCE, etc.) often expose metadata services locally to instances.</p><p class="lh-copy measure-wide f4">By default, these APIs are accessible by pods running on an instance and can contain cloud credentials for that node, or provisioning data such as kubelet credentials.</p><p class="lh-copy measure-wide f4">These credentials can be used to escalate within the cluster or to other cloud services under the same account.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="restrict-access-to-alpha-or-beta-features">Restrict access to alpha or beta features</h3></label><input type="checkbox" name="approved-kubernetes-configuration-2" id="approved-kubernetes-configuration-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-approved-kubernetes-configuration-2,.controls-approved-kubernetes-configuration-2"></p><h3 class="f3 pt3" id="restrict-access-to-alpha-or-beta-features">Restrict access to alpha or beta features</h3><p></p><div class="controls controls-approved-kubernetes-configuration-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-approved-kubernetes-configuration-2,.controls-approved-kubernetes-configuration-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-approved-kubernetes-configuration-2,.controls-approved-kubernetes-configuration-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-approved-kubernetes-configuration-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Alpha and beta Kubernetes features are in active development and may have limitations or bugs that result in security vulnerabilities.</p><p class="lh-copy measure-wide f4">Always assess the value an alpha or beta feature may provide against the possible risk to your security posture.</p><p class="lh-copy measure-wide f4">When in doubt, disable features you do not use.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-06964881728594572,.controls-06964881728594572">Authentication</p><div class="controls controls-06964881728594572 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-06964881728594572,.controls-06964881728594572" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-06964881728594572,.controls-06964881728594572"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-06964881728594572 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Kubernetes supports different authentication strategies:</p><ul><li class="lh-copy f4 mv1 measure-wide"><strong class="b">Static Tokens</strong>: are difficult to invalidate and should be avoided</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">Bootstrap Tokens</strong>: same as static tokens above</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">Basic Authentication</strong> transmits credentials over the network in cleartext</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">X509 client certs</strong> requires renewing and redistributing client certs regularly</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">Service Account Tokens</strong> are the preferred authentication strategy for applications and workloads running in the cluster</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">OpenID Connect (OIDC) Tokens</strong>: best authentication strategy for end-users as OIDC integrates with your identity provider such as AD, AWS IAM, GCP IAM, etc.</li></ul><p class="lh-copy measure-wide f4">You can learn about the strategies in more detail <a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">in the official documentation</a>.</p></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="use-openid-oidc-tokens-as-a-user-authentication-strategy">Use OpenID (OIDC) tokens as a user authentication strategy</h3></label><input type="checkbox" name="authentication-0" id="authentication-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-authentication-0,.controls-authentication-0"></p><h3 class="f3 pt3" id="use-openid-oidc-tokens-as-a-user-authentication-strategy">Use OpenID (OIDC) tokens as a user authentication strategy</h3><p></p><div class="controls controls-authentication-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-authentication-0,.controls-authentication-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-authentication-0,.controls-authentication-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-authentication-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Kubernetes supports various authentication methods, including OpenID Connect (OIDC).</p><p class="lh-copy measure-wide f4">OpenID Connect allows single sign-on (SSO) such as your Google Identity to connect to a Kubernetes cluster and other development tools.</p><p class="lh-copy measure-wide f4">You don't need to remember or manage credentials separately.</p><p class="lh-copy measure-wide f4">You could have several clusters connect to the same OpenID provider.</p><p class="lh-copy measure-wide f4">You can <a href="https://thenewstack.io/kubernetes-single-sign-one-less-identity/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">learn more about the OpenID connect in Kubernetes</a> in this article.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-006944042890005364,.controls-006944042890005364">Role-Based Access Control (RBAC)</p><div class="controls controls-006944042890005364 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-006944042890005364,.controls-006944042890005364" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-006944042890005364,.controls-006944042890005364"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-006944042890005364 toggle-collapse"><div class="ph4 pt2 pb4"></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="serviceaccount-tokens-are-for-applications-and-controllers-only">ServiceAccount tokens are for applications and controllers <strong class="b">only</strong></h3></label><input type="checkbox" name="role-based-access-control-rbac--0" id="role-based-access-control-rbac--0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-role-based-access-control-rbac--0,.controls-role-based-access-control-rbac--0"></p><h3 class="f3 pt3" id="serviceaccount-tokens-are-for-applications-and-controllers-only">ServiceAccount tokens are for applications and controllers <strong class="b">only</strong></h3><p></p><div class="controls controls-role-based-access-control-rbac--0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-role-based-access-control-rbac--0,.controls-role-based-access-control-rbac--0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-role-based-access-control-rbac--0,.controls-role-based-access-control-rbac--0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-role-based-access-control-rbac--0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Service Account Tokens should not be used for end-users trying to interact with Kubernetes clusters, but they are the preferred authentication strategy for applications and workloads running on Kubernetes.</p></div></div></div></li></ul></section><section class="pl4-l"><div class="module"><div class="ph3 flex items-center ba b--light-gray bg-navy relative"><p class="f4 f3-ns b v-mid pl3 white pointer mv3" data-toggle=".details-01478893190352959,.controls-01478893190352959">Logging setup</p><div class="controls controls-01478893190352959 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-01478893190352959,.controls-01478893190352959" data-toggle-collapsed=""><img src="https://learnk8s.io/a/31915fc183d9c0a7df72a2e4a552df50.svg" alt="Info" class="w1 h1"></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-01478893190352959,.controls-01478893190352959"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-01478893190352959 toggle-collapse"><div class="ph4 pt2 pb4"></div></div></div><ul class="list pl0 mv0 bb b--light-gray"><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="there-s-a-retention-and-archival-strategy-for-logs">There's a retention and archival strategy for logs</h3></label><input type="checkbox" name="logging-setup-0" id="logging-setup-0" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-logging-setup-0,.controls-logging-setup-0"></p><h3 class="f3 pt3" id="there-s-a-retention-and-archival-strategy-for-logs">There's a retention and archival strategy for logs</h3><p></p><div class="controls controls-logging-setup-0 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-logging-setup-0,.controls-logging-setup-0" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-logging-setup-0,.controls-logging-setup-0" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-logging-setup-0 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">You should retain 30-45 days of historical logs.</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="logs-are-collected-from-nodes-control-plane-auditing">Logs are collected from Nodes, Control Plane, Auditing</h3></label><input type="checkbox" name="logging-setup-1" id="logging-setup-1" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-logging-setup-1,.controls-logging-setup-1"></p><h3 class="f3 pt3" id="logs-are-collected-from-nodes-control-plane-auditing">Logs are collected from Nodes, Control Plane, Auditing</h3><p></p><div class="controls controls-logging-setup-1 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-logging-setup-1,.controls-logging-setup-1" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-logging-setup-1,.controls-logging-setup-1" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-logging-setup-1 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">What to collect logs from:</p><ul><li class="lh-copy f4 mv1 measure-wide">Nodes (kubelet, container runtime)</li><li class="lh-copy f4 mv1 measure-wide">Control plane (API server, scheduler, controller manager)</li><li class="lh-copy f4 mv1 measure-wide">Kubernetes auditing (all requests to the API server)</li></ul><p class="lh-copy measure-wide f4">What you should collect:</p><ul><li class="lh-copy f4 mv1 measure-wide">Application name. Retrieved from metadata labels.</li><li class="lh-copy f4 mv1 measure-wide">Application instance. Retrieved from metadata labels.</li><li class="lh-copy f4 mv1 measure-wide">Application version. Retrieved from metadata labels.</li><li class="lh-copy f4 mv1 measure-wide">Cluster ID. Retrieved from Kubernetes cluster.</li><li class="lh-copy f4 mv1 measure-wide">Container name. Retrieved from Kubernetes API.</li><li class="lh-copy f4 mv1 measure-wide">Cluster node running this container. Retrieved from Kubernetes cluster.</li><li class="lh-copy f4 mv1 measure-wide">Pod name running the container. Retrieved from Kubernetes cluster.</li><li class="lh-copy f4 mv1 measure-wide">The namespace. Retrieved from Kubernetes cluster.</li></ul></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="prefer-a-daemon-on-each-node-to-collect-the-logs-instead-of-sidecars">Prefer a daemon on each node to collect the logs instead of sidecars</h3></label><input type="checkbox" name="logging-setup-2" id="logging-setup-2" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-logging-setup-2,.controls-logging-setup-2"></p><h3 class="f3 pt3" id="prefer-a-daemon-on-each-node-to-collect-the-logs-instead-of-sidecars">Prefer a daemon on each node to collect the logs instead of sidecars</h3><p></p><div class="controls controls-logging-setup-2 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-logging-setup-2,.controls-logging-setup-2" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-logging-setup-2,.controls-logging-setup-2" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-logging-setup-2 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Applications should log to stdout rather than to files.</p><p class="lh-copy measure-wide f4"><a href="https://rclayton.silvrback.com/container-services-logging-with-docker#effective-logging-infrastructure" target="_blank" rel="noreferrer" class="link navy underline hover-sky">A daemon on each node can collect the logs from the container runtime</a> (if logging to files, a sidecar container for each pod might be necessary).</p></div></div></div></li><li><div class="module"><div class="ph3 flex items-center bt bl br b--light-gray relative bg-evian"><label for="one" class="dn"><h3 class="f3 pt3" id="provision-a-log-aggregation-tool">Provision a log aggregation tool</h3></label><input type="checkbox" name="logging-setup-3" id="logging-setup-3" class="tick-checkbox input-reset h2 w2 ba bw2 b--light-gray br-100 v-mid bg-white pointer flex-shrink-0"><p class="f5 f4-ns v-mid pl3 navy pointer pr4" data-toggle=".details-logging-setup-3,.controls-logging-setup-3"></p><h3 class="f3 pt3" id="provision-a-log-aggregation-tool">Provision a log aggregation tool</h3><p></p><div class="controls controls-logging-setup-3 absolute top-50 right-1 toggle-collapse"><button class="open dib bg-transparent bn pointer" data-toggle=".details-logging-setup-3,.controls-logging-setup-3" data-toggle-collapsed="" aria-label="Open"><i class="arr-down"></i></button><button class="close dib bg-transparent bn pointer" data-toggle=".details-logging-setup-3,.controls-logging-setup-3" aria-label="Close"><i class="arr-up"></i></button></div></div><div class="bg-white bl br b--light-gray details details-logging-setup-3 toggle-collapse"><div class="ph4 pt2 pb4"><p class="lh-copy measure-wide f4">Use a log aggregation tool such as EFK stack (Elasticsearch, Fluentd, Kibana), DataDog, Sumo Logic, Sysdig, GCP Stackdriver, Azure Monitor, AWS CloudWatch.</p></div></div></div></li></ul></section></div></div></div><div class="mb4 mb5-l mw8 center pt4"><ul class="list pl0 flex flex-wrap"><li class="w-50-ns f5 bg-evian br2 ph4"><p class="pb3 f2 b navy mb2 b mt4">What is Learnk8s?</p><p class="lh-copy f4 measure-narrow pt0 mt0">In-depth Kubernetes training that is practical and easy to understand.</p></li><li class="w-50-ns f5 ph4 pv2"><a class="link dib f3 navy b bb bw1 pb3 mb3 pt3 hover-sky" href="/training">⎈ Instructor-led workshops <span class="f5 v-mid dib pb1 pl1">❯</span></a><p class="lh-copy f4 measure-narrow pt0 mt0">Deep dive into containers and Kubernetes with the help of our instructors and become an expert in deploying applications at scale.</p></li><li class="w-50-ns f5 ph4 pv2"><a class="link dib f3 navy b bb bw1 pb3 mb3 pt3 hover-sky" href="/academy">⎈ Online courses <span class="f5 v-mid dib pb1 pl1">❯</span></a><p class="lh-copy f4 measure-narrow pt0 mt0">Learn Kubernetes online with hands-on, self-paced courses. No need to leave the comfort of your home.</p></li><li class="w-50-ns f5 ph4 pv2"><a class="link dib f3 navy b bb bw1 pb3 mb3 pt3 hover-sky" href="/corporate-training">⎈ Corporate training <span class="f5 v-mid dib pb1 pl1">❯</span></a><p class="lh-copy f4 measure-narrow pt0 mt0">Train your team in containers and Kubernetes with a customised learning path — remotely or on-site.</p></li></ul></div><footer class="footer white ph3 ph4-ns pt4 pt5-ns pb3 bg-sky"><section class="flex-ns items-start-ns justify-around-ns pr3-m pr7-l"><div class="dn db-l"><a href="/" class="logo w4 db" title="Learnk8s logo"><svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 139 52"><path d="M37.11 24.48c-.993 0-1.833.84-1.833 1.832 0 .993.84 1.833 1.832 1.833.993 0 1.833-.84 1.833-1.833 0-.992-.84-1.832-1.833-1.832"></path><path d="M37.11 30.468c-1.451 0-2.75-.764-3.437-1.91a52.731 52.731 0 0 0-1.603 4.353c-1.68 4.658-2.825 7.636-4.276 8.705-.764.763-1.756 1.221-2.978 1.221a4.106 4.106 0 0 1-4.123-4.123c0-1.45.763-2.749 1.909-3.436a52.731 52.731 0 0 0-4.353-1.603c-4.657-1.68-7.635-2.825-8.704-4.276-.764-.764-1.222-1.756-1.222-2.978a4.106 4.106 0 0 1 4.123-4.123c1.451 0 2.75.763 3.436 1.909a52.772 52.772 0 0 0 1.604-4.353c1.68-4.657 2.825-7.635 4.276-8.704.763-.764 1.756-1.222 2.978-1.222a4.106 4.106 0 0 1 4.123 4.123c0 1.45-.764 2.749-1.909 3.436 1.45.611 3.13 1.222 4.352 1.604 4.658 1.68 7.636 2.825 8.705 4.276.764.763 1.222 1.756 1.222 2.978 0 2.214-1.833 4.123-4.124 4.123M27.336 2.445c-.993-.993-2.52-.993-3.513 0L1.757 24.512c-.993.993-.993 2.52 0 3.512l22.066 22.067c.993.993 2.52.993 3.513 0l22.067-22.067c.992-.992.992-2.52 0-3.512L27.336 2.445z"></path><path d="M12.424 24.48c-.992 0-1.832.84-1.832 1.832 0 .993.84 1.833 1.832 1.833.993 0 1.833-.84 1.833-1.833 0-.992-.84-1.832-1.833-1.832m12.343 12.342c-.993 0-1.833.84-1.833 1.833s.84 1.832 1.833 1.832c.992 0 1.832-.84 1.832-1.832 0-.993-.84-1.833-1.832-1.833M21.884 16.87c-.229-.23-.458-.459-.61-.764a52.731 52.731 0 0 0-1.604 4.352c-1.68 4.658-2.825 7.636-4.276 8.705-.23.229-.458.458-.764.61a52.639 52.639 0 0 0 4.353 1.604c4.657 1.68 7.635 2.825 8.704 4.276.23.229.458.458.611.763.61-1.45 1.222-3.13 1.603-4.352 1.68-4.658 2.826-7.635 4.276-8.704.23-.23.459-.459.764-.611a52.731 52.731 0 0 0-4.352-1.604c-4.658-1.603-7.712-2.749-8.705-4.276m2.883-1.111c.992 0 1.832-.84 1.832-1.833s-.84-1.833-1.832-1.833c-.993 0-1.833.84-1.833 1.833 0 1.069.84 1.833 1.833 1.833m36.766 14.957c-.153-.153-.23-.306-.23-.458-.076-.23-.076-.458-.076-.764V16.665l-1.909.306v12.751c0 .993.23 1.756.764 2.215.458.458 1.298.763 2.52.763l.229-1.603c-.306-.077-.535-.077-.764-.153a.693.693 0 0 1-.534-.23m4.847-4.52c.075-.382.152-.763.228-1.069.153-.382.306-.687.535-.916.229-.306.534-.458.84-.687.305-.153.687-.23 1.145-.23.763 0 1.374.306 1.832.84.459.535.688 1.222.611 2.138H66.38zm2.824-4.581c-.61 0-1.221.152-1.832.381-.611.23-1.07.611-1.527 1.07a4.532 4.532 0 0 0-1.07 1.756c-.305.687-.381 1.527-.381 2.443 0 .84.076 1.527.305 2.214a5.01 5.01 0 0 0 .993 1.757c.458.458.992.84 1.68 1.145.687.305 1.45.382 2.367.382a7.88 7.88 0 0 0 1.985-.23c.61-.152.993-.228 1.222-.381l-.23-1.604c-.228.077-.61.23-1.068.306-.458.153-.993.153-1.68.153-1.222 0-2.062-.306-2.596-.84-.535-.535-.917-1.375-.993-2.52h7.254v-.687c0-1.833-.382-3.207-1.145-4.047-.764-.84-1.91-1.298-3.284-1.298m12.826 9.45c-.23.077-.535.077-.84.077h-1.222c-.764 0-1.375-.153-1.756-.382-.459-.23-.688-.764-.688-1.451 0-.382.077-.687.23-.916.152-.23.381-.382.687-.535s.534-.229.916-.229c.305-.076.61-.076.916-.076.458 0 .84 0 1.145.076.306.077.535.077.688.153v3.283zm.992-8.323c-.305-.381-.764-.61-1.298-.84-.535-.229-1.145-.305-1.909-.305-.687 0-1.298.076-1.833.153-.534.076-.992.229-1.221.305l.229 1.604c.229-.077.61-.153 1.069-.306a9.723 9.723 0 0 1 1.68-.153c.458 0 .916.077 1.221.23s.535.305.764.61c.153.23.305.535.382.84.076.306.076.611.076.917v.534c-.076 0-.153 0-.305-.076-.153 0-.306-.077-.459-.077-.152 0-.381-.076-.61-.076h-.611c-.611 0-1.146.076-1.756.153-.535.152-.993.305-1.451.61-.382.23-.764.611-.993.993-.229.458-.382.916-.382 1.527 0 .611.077 1.146.306 1.604s.458.763.84 1.069c.382.229.84.458 1.298.61.534.153 1.069.153 1.68.153.458 0 .84 0 1.298-.076.458 0 .84-.076 1.221-.076.382-.077.688-.077.993-.153.305-.076.535-.076.687-.076v-6.643c0-.611-.076-1.146-.229-1.68a3.876 3.876 0 0 0-.687-1.375m9.128-.94c-.229 0-.382-.076-.61-.076h-.535c-.84 0-1.604.076-2.215.229-.687.153-1.221.305-1.68.458v10.155h1.91v-8.933c.076 0 .305-.077.687-.153.382-.076.687-.076 1.069-.076.534 0 .992.076 1.374.076.382.076.611.153.764.229l.305-1.68c-.076 0-.229-.076-.382-.076-.305-.077-.458-.153-.687-.153m10.503 1.264c-.305-.458-.763-.763-1.374-.993-.534-.229-1.298-.381-2.138-.381-.916 0-1.756.076-2.52.152-.687.153-1.298.23-1.756.382v10.308h1.909v-9.01c.076 0 .153 0 .305-.076.153 0 .306-.076.535-.076.229 0 .382 0 .61-.077h.612c.534 0 .916.077 1.298.23.305.152.61.305.84.61.229.306.381.687.458 1.145.076.459.152.993.152 1.68v5.574h1.91v-5.956c0-.687-.077-1.374-.23-1.985-.076-.61-.305-1.145-.61-1.527m12.032 6.312c-.381-.535-.84-1.07-1.298-1.604a10.45 10.45 0 0 0-1.298-1.298c.84-.84 1.604-1.603 2.291-2.367a618.04 618.04 0 0 1 2.138-2.367h-3.589c-.229.229-.382.534-.687.84-.229.305-.534.61-.84.992-.305.382-.61.688-.916 1.07-.306.381-.611.687-.916.992v-9.01l-3.055.458v15.424h3.055v-4.734c.305.305.687.61 1.069.993.381.381.687.84.992 1.221.306.459.611.84.916 1.298.306.459.535.84.764 1.146h3.512c-.229-.458-.534-.916-.84-1.527-.458-.382-.84-.917-1.298-1.527m9.547.514c-.305.306-.84.535-1.527.535-.382 0-.687-.076-.916-.152a1.663 1.663 0 0 1-.61-.382 2.32 2.32 0 0 1-.383-.535c-.076-.229-.076-.381-.076-.534 0-.535.153-.993.382-1.375.229-.381.61-.687.992-.992.382.152.764.229 1.07.382.305.152.61.305.84.458.228.152.457.381.61.61.153.23.23.535.23.84a2.12 2.12 0 0 1-.612 1.146m-3.13-8.4c.076-.152.152-.381.305-.534.153-.153.306-.305.535-.382.229-.076.458-.152.763-.152.306 0 .611.076.764.152.229.077.382.23.534.382a1.6 1.6 0 0 1 .306.458c.076.153.076.306.076.458 0 .535-.153.917-.382 1.298a2.32 2.32 0 0 1-.992.917c-.764-.306-1.298-.611-1.68-.993-.306-.382-.458-.763-.458-1.222.076 0 .152-.152.229-.381m4.505 3.588c.534-.305.916-.763 1.298-1.374.382-.535.534-1.145.534-1.833 0-.458-.076-.916-.229-1.374-.153-.458-.458-.84-.84-1.222a3.941 3.941 0 0 0-1.45-.916 5.942 5.942 0 0 0-2.138-.382c-.688 0-1.375.077-1.91.306a3.943 3.943 0 0 0-1.45.916c-.382.382-.764.84-.916 1.298-.23.534-.306.993-.306 1.603 0 .688.153 1.299.382 1.757a5.37 5.37 0 0 0 1.298 1.374 7.12 7.12 0 0 0-.764.687c-.229.23-.458.458-.61.764-.23.305-.306.61-.459.916a4.621 4.621 0 0 0-.152 1.145c0 .382.076.84.229 1.299.153.458.458.916.84 1.298a4.42 4.42 0 0 0 1.527.992c.61.23 1.45.382 2.367.382.84 0 1.527-.076 2.214-.305a5.493 5.493 0 0 0 1.604-.917c.458-.381.763-.84.916-1.374.23-.535.305-1.07.305-1.68 0-.764-.152-1.374-.534-1.909-.458-.458-.993-.992-1.756-1.45m11.836 3.327c-.076-.306-.305-.688-.534-.917-.23-.305-.611-.534-1.07-.763-.458-.23-.992-.458-1.68-.764-.305-.153-.61-.229-.84-.305-.228-.077-.38-.23-.534-.306-.152-.076-.229-.152-.229-.305-.076-.076-.076-.23-.076-.306 0-.534.458-.763 1.45-.763.535 0 .993.076 1.375.153.382.076.764.229 1.145.305l.535-2.367c-.382-.153-.84-.229-1.45-.382-.612-.152-1.223-.152-1.91-.152-1.298 0-2.367.305-3.054.916s-1.145 1.374-1.145 2.367c0 .534.076.992.229 1.298.152.382.382.687.61.916.306.23.611.458.993.687.382.23.84.382 1.298.535.611.229 1.07.458 1.375.61.305.153.458.383.458.612 0 .305-.153.534-.382.61-.229.077-.61.153-1.222.153-.534 0-1.069-.076-1.603-.153l-1.604-.458-.534 2.444c.229.076.687.229 1.298.381.61.153 1.45.23 2.367.23 1.45 0 2.596-.306 3.36-.84.763-.535 1.221-1.375 1.221-2.444.306-.229.23-.61.153-.992"></path></svg></a><p>The Kubernetes training company</p></div><div class="dn db-ns"><h2 class="ttu f6">Services</h2><ul class="list pl0"><li><a href="/training" class="db link white pv1 no-underline underline-hover">Training</a></li><li><a href="/kubernetes-online-classroom" class="db link white pv1 no-underline underline-hover">Online classrooms</a></li><li><a href="/academy" class="db link white pv1 no-underline underline-hover">Self-paced courses</a></li><li><a href="/consulting" class="db link white pv1 no-underline underline-hover">Consulting</a></li></ul></div><div class=""><h2 class="ttu f6">Company</h2><ul class="list pl0"><li><a href="/contact-us" class="db link white pv1 no-underline underline-hover">Contact us</a></li><li><a href="/about-us" class="db link white pv1 no-underline underline-hover">Team</a></li><li><a href="/careers" class="db link white pv1 no-underline underline-hover">Careers</a></li><li><a href="/blog" class="db link white pv1 no-underline underline-hover">Blog</a></li><li><a href="/newsletter" class="db link white pv1 no-underline underline-hover">Newsletter</a></li></ul></div><div class="pt3 pt0-ns"><h2 class="ttu f6">Keep in touch</h2><ul class="list pl0"><li class="dib"><a href="https://github.com/learnk8s" class="link dib w2 h2 icon" title="Learnk8s on GitHub" rel="noreferrer" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path fill="#ffffff" d="M30 6C16.8 6 6 17 6 30.6 6 41.5 12.9 50.7 22.4 54c1.2.2 1.6-.5 1.6-1.2v-4.2c-6.7 1.5-8.1-3.3-8.1-3.3-1.1-2.8-2.7-3.6-2.7-3.6-2.2-1.5.2-1.5.2-1.5 2.4.2 3.7 2.5 3.7 2.5 2.1 3.8 5.6 2.7 7 2 .2-1.6.8-2.7 1.5-3.3-5.3-.6-10.9-2.7-10.9-12.2 0-2.7.9-4.9 2.5-6.6-.2-.6-1.1-3.1.2-6.5 0 0 2-.7 6.6 2.5 1.9-.5 4-.8 6-.8s4.1.3 6 .8c4.6-3.2 6.6-2.5 6.6-2.5 1.3 3.4.5 5.9.2 6.5 1.5 1.7 2.5 3.9 2.5 6.6 0 9.5-5.6 11.5-11 12.1.9.8 1.6 2.3 1.6 4.6v6.8c0 .7.4 1.4 1.7 1.2C47.2 50.7 54 41.5 54 30.6 54 17 43.3 6 30 6z"></path></svg></a></li><li class="dib"><a href="https://twitter.com/learnk8s" class="link dib w2 h2 icon" title="Learnk8s on Twitter" rel="noreferrer" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path fill="#ffffff" d="M50.2 12.7c-1.7 1-3.5 1.8-5.5 2.2-1.6-1.8-3.8-2.9-6.3-2.9-4.8 0-8.6 4.1-8.6 9.1 0 .7.1 1.4.2 2.1-7.2-.4-13.5-4-17.8-9.5-.7 1.3-1.2 2.9-1.2 4.6 0 3.2 1.5 5.9 3.8 7.6-1.4 0-2.7-.5-3.9-1.1v.1c0 4.4 3 8.1 6.9 8.9-.7.2-1.5.3-2.3.3-.6 0-1.1-.1-1.6-.2 1.1 3.6 4.3 6.2 8 6.3-3 2.4-6.7 3.9-10.7 3.9-.7 0-1.4 0-2.1-.1 3.8 2.6 8.3 4.1 13.2 4.1C38.4 48 47 34.2 47 22.1v-1.2c1.7-1.3 3.1-2.9 4.3-4.7-1.5.7-3.2 1.2-4.9 1.4 1.7-1 3.1-2.8 3.8-4.9z"></path></svg></a></li><li class="dib"><a href="https://www.linkedin.com/company/learnk8s/" class="link dib w2 h2 icon" title="Learnk8s on LinkedIn" rel="noreferrer" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path fill="#ffffff" d="M14.8 10c-2.9 0-4.8 2-4.8 4.7 0 2.6 1.8 4.7 4.7 4.7h.1c2.9 0 4.8-2.1 4.8-4.7-.2-2.7-2-4.7-4.8-4.7zM11 22.8h7.8V50H11zM40.1 22.6c-4.5 0-7.3 2.7-7.8 4.5v-4.3h-8.8c.1 2.3 0 27.2 0 27.2h8.8V35.3c0-.8 0-1.6.2-2.2.6-1.6 1.9-3.3 4.2-3.3 3 0 4.4 2.5 4.4 6.2v14H50V34.9c0-8.4-4.4-12.3-9.9-12.3z"></path></svg></a></li><li class="dib"><a href="/slack" class="link dib w2 h2 icon" title="Learnk8s on Slack" rel="noreferrer" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path fill="#ffffff" d="M25.913 27.84l5.88-1.968 1.904 5.69-5.88 1.968z"></path><path fill="#ffffff" d="M24 9.8C8.8 14.4 5.3 20.9 9.8 36 14.4 51.2 20.9 54.7 36 50.2 51.2 45.6 54.7 39.1 50.2 24 45.6 8.8 39.1 5.3 24 9.8zm18.5 24l-2.9 1 1 3c.4 1.2-.2 2.5-1.4 2.9-.3.1-.5.1-.8.1-.9 0-1.8-.6-2.1-1.6l-1-2.9-5.9 2 1 2.9c.4 1.2-.2 2.5-1.4 2.9-.3.1-.5.1-.8.1-.9 0-1.8-.6-2.1-1.6l-1-3-2.9 1c-.3.1-.5.1-.8.1-.9 0-1.8-.6-2.1-1.6-.4-1.2.2-2.5 1.4-2.9l2.9-1-1.9-5.7-2.9 1c-.3.1-.5.1-.8.1-.9 0-1.8-.6-2.1-1.6-.4-1.2.2-2.5 1.4-2.9l2.9-1-1-2.9c-.4-1.2.2-2.5 1.4-2.9 1.2-.4 2.5.2 2.9 1.4l1 2.9 5.9-2-1-2.9c-.4-1.2.2-2.5 1.4-2.9 1.2-.4 2.5.2 2.9 1.4l1 3 2.9-1c1.2-.4 2.5.2 2.9 1.4.4 1.2-.2 2.5-1.4 2.9l-2.9 1 1.9 5.7 2.9-1c1.2-.4 2.5.2 2.9 1.4.5 1.5-.2 2.8-1.4 3.2z"></path></svg></a></li><li class="dib"><a href="/telegram" class="link dib w2 h2 icon" title="Learnk8s on Telegram" rel="noreferrer" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-6 -6 60 60"><path d="M0 24c0 13.255 10.745 24 24 24s24-10.745 24-24S37.255 0 24 0 0 10.745 0 24zm19.6 11l.408-6.118 11.129-10.043c.488-.433-.107-.645-.755-.252l-13.735 8.665-5.932-1.851c-1.281-.393-1.29-1.273.287-1.906l23.118-8.914c1.056-.48 2.075.254 1.672 1.87l-3.937 18.552c-.275 1.319-1.071 1.634-2.175 1.025l-5.997-4.431L20.8 34.4l-.027.026c-.322.314-.59.574-1.173.574z" fill="#ffffff"></path></svg></a></li></ul></div></section><section class="pt2 pt5-ns"><p class="f7 bt b--light-blue pv2 white-70">Copyright © Learnk8s 2017-2022. Made with ❤︎ in London. View our <a class="link white-70" href="/terms-and-conditions">Terms and Conditions</a> or <a class="link white-70" href="/privacy-policy">Privacy Policy</a>. Send us a note to <a href="mailto:hello@learnk8s.io" class="link white underline">hello@learnk8s.io</a></p></section></footer></div><script>!function(){function e(e){return!e}function t(t){var c=t.getAttribute("data-toggle");if(c){var r=c.split(",").map((function(e){return document.querySelector(e)}));r.some(e)||(r[0].classList.contains("toggle-collapse")?r.forEach((function(e){return e.classList.remove("toggle-collapse")})):r.forEach((function(e){return e.classList.add("toggle-collapse")})))}}[].slice.call(document.querySelectorAll("[data-toggle]")).forEach((function(e){e.addEventListener("click",(function(){t(e)}))})),[].slice.call(document.querySelectorAll("[data-toggle-collapsed]")).forEach(t)}(),function(e){const t=document.querySelector(".js-left");if(!t)return;const c=document.createElement("div");c.innerHTML=e,t.prepend(c);const r=document.querySelector(".js-checklist"),o=document.querySelector(".js-progress-bar"),s=document.querySelector(".js-active-progress-bar"),l=document.querySelector(".js-progress-percentage");if(!r||!o||!s)return;const n=o.clientWidth,a=r.querySelectorAll('input[type="checkbox"]');function i(){const e=Array.from(a).filter((e=>e.checked)).length/a.length;s.style.width=e*n+"px",l.innerText=`${Math.ceil(100*e)}% complete`}a.forEach((e=>{e.addEventListener("click",i)})),i()}('<section class=""><p class="gray ttu f7 mb0">Your progress</p><p class="mt2 mb3 b navy f4 js-progress-percentage">0% complete</p><div class="w-100 relative"><div class="pa1 bg-blue br2 js-active-progress-bar absolute top-0 left-0"></div><div class="pa1 w-100 bg-light-gray br2 br--right js-progress-bar"></div></div></section>');</script></body></html>
